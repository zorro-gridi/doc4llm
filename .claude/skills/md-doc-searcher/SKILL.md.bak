---
name: md-doc-searcher
description: Search and discover markdown documents in the doc4llm knowledge base using semantic understanding. Use this skill when Claude needs to find documents matching a query, list available documentation, search document titles by understanding user intent, or discover which documentation sets contain relevant content. Performs comprehensive search across relevant documentation sets and returns exhaustive list of relevant document titles with coverage verification.
allowed-tools:
  - Read
  - Glob
  - Bash
context: fork
protocol: AOP
protocol_version: "1.0"
---

# Markdown Document Searcher

Search and discover markdown documents in the doc4llm knowledge base directory structure using semantic matching.

## Data Flow Integration

**Input Source:** This skill receives **optimized queries from `md-doc-query-optimizer`** skill, not raw user queries.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Query Optimization Phase                  â”‚
â”‚                   (md-doc-query-optimizer)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ 3-5 optimized queries
                            â”‚ with strategy annotations
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Document Discovery Phase                  â”‚
â”‚                      (md-doc-searcher)                       â”‚
â”‚                                                              â”‚
â”‚  Input: Optimized queries from Phase 0                      â”‚
â”‚  Output: Document titles with heading lists                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Why This Matters:**
- **Multi-perspective search:** Receives 3-5 query variations instead of a single raw query
- **Better recall:** Decomposition, expansion, and translation strategies improve coverage
- **Language handling:** Pre-translated queries (Chineseâ†’English) improve matching accuracy
- **Ambiguity resolution:** Multiple query variants capture different interpretations

## Core Principle

This skill focuses on **document discovery via TOC (Table of Contents)** - finding which documents match your query by searching `docTOC.md` index files.

## æ ¸å¿ƒæ£€ç´¢çº¦æŸ

**æ£€ç´¢æ­£æ–‡åªå…è®¸è¿”å› docTOC.md æ–‡ä»¶ä¸­çš„ heading åˆ—è¡¨**

| æ“ä½œ | å…è®¸ | è¯´æ˜ |
|------|------|------|
| ä» docTOC.md æå– heading åˆ—è¡¨ | âœ… | ä¸»è¦æ£€ç´¢æ–¹å¼ |
| å¯¹ docTOC.md ä½¿ç”¨ grep æœç´¢ | âœ… | Fallback Strategy 1 |
| å¯¹ docContent.md ä½¿ç”¨ grep -B N | âœ… | ä»…è·å–ä¸Šä¸‹æ–‡ç‰‡æ®µ |
| å›æº¯åˆ° docTOC.md ä¸­çš„ heading | âœ… | ä»ä¸Šä¸‹æ–‡å®šä½å¯¹åº” heading |
| è¿”å› docContent.md å…·ä½“å†…å®¹ | âŒ | ç¦æ­¢è¿”å›æ­£æ–‡å†…å®¹ |
| ä½¿ç”¨ Read å·¥å…·è¯»å– docContent.md | âŒ | ä¸¥æ ¼ç¦æ­¢ |

**å¿…é¡»éµå¾ªçš„åˆ†ç»„çº¦æŸï¼š**

æ‰€æœ‰ heading å¿…é¡»æŒ‰å±‚çº§åˆ†ç»„å½’å±ï¼Œæ ¼å¼ä¸ºï¼š

```
<doc_name>:<doc_version>
  â””â”€â”€ <PageTitle>
        â””â”€â”€ ## Heading1 (score)
        â””â”€â”€ ### Heading2 (score)
```

**æ¯ä¸ª heading å¿…é¡»æ˜ç¡®å½’å±ï¼š**
1. **æ–‡æ¡£é›†å±‚çº§** - `<doc_name>:<doc_version>`
2. **é¡µé¢æ ‡é¢˜å±‚çº§** - `<PageTitle>`ï¼ˆå³ç›®å½•åï¼‰
3. **heading å±‚çº§** - å…·ä½“ heading åŠå…¶è¯„åˆ†

**ç¦æ­¢çš„è¡Œä¸ºï¼š**
- âŒ è¿”å›æ— å½’å±çš„ heading åˆ—è¡¨ï¼ˆæœªæ ‡æ³¨ doc_set å’Œ PageTitleï¼‰
- âŒ æ‰å¹³åŒ–æ‰€æœ‰ headingï¼ˆä¸¢å¤±æ–‡æ¡£ç»“æ„å±‚æ¬¡ï¼‰
- âŒ è·¨ PageTitle æ··åˆ heading

**å·¥ä½œæµï¼š** docContent.md â†’ grep ä¸Šä¸‹æ–‡ â†’ å›æº¯ heading â†’ ä»…è¿”å› docTOC.md heading åˆ—è¡¨

**CRITICAL:**
- âœ… **DO:** Search `docTOC.md` files and return TOC paths with heading lists
- âœ… **DO:** Use `grep -B 10` on `docContent.md` **only for context traceback** (find heading, discard content)
- âŒ **DON'T:** Use `Read` tool to load entire `docContent.md` files
- âŒ **DON'T:** Return any `docContent.md` content as search results
- âŒ **DON'T:** Return `docContent.md` paths as primary results
- âŒ **DON'T:** Return full TOC content - return filtered heading lists only

**Workflow:** This skill finds documents â†’ extracts headings â†’ returns heading lists â†’ `md-doc-reader` skill extracts content

This follows the **progressive disclosure** principle: discover structure first (filtered headings), then access content later.

## Bash Tool Operations

### Read Knowledge Base Configuration

```bash
Bash: Read .claude/knowledge_base.json
```

### List Documentation Sets

```bash
Bash: ls -1 "{knowledge_base}/"
```

### Find TOC Files in Doc-Set

```bash
Bash: find "{knowledge_base}/<doc_name>:<doc_version>" -name "docTOC.md" -type f
```

### Grep in TOC Content (Fallback Strategy 1)

```bash
Bash: grep -r -iE "(keyword1|keyword2)" "{knowledge_base}/<doc_set>"/*/docTOC.md
```

### Grep in Content with Context (Fallback Strategy 2)

```bash
Bash: grep -r -i -B 10 "keyword" "{knowledge_base}/<doc_set>"/*/docContent.md
```
**Purpose:** Get context only for heading traceback - discard after use

**Retry with expanded context:**
```bash
Bash: grep -r -i -B 20 "keyword" "{knowledge_base}/<doc_set>"/*/docContent.md  # 2nd attempt
Bash: grep -r -i -B 50 "keyword" "{knowledge_base}/<doc_set>"/*/docContent.md  # 3rd attempt
```

### Extract Title from Content

```bash
Bash: head -n 5 "{knowledge_base}/<doc_set>/<PageTitle>/docContent.md"
```

## Semantic Retrieval Functions

Use these functions for semantic analysis:

- **SearchHelpers.extract_keywords()** - Extract keywords from query
- **SearchHelpers.analyze_query_intent()** - Get intent framework
- **SearchHelpers.extract_headings_with_levels()** - Parse TOC headings
- **SearchHelpers.calculate_page_title_relevance_score()** - PageTitle scoring framework
- **SearchHelpers.calculate_heading_relevance_score()** - Heading scoring framework
- **SearchHelpers.annotate_headings_with_page_title()** - Annotate grep results
- **SearchHelpers.traceback_to_heading()** - Trace content match to heading

## Core Retrieval Flow (v4.1.0)

This skill implements a **4-step retrieval process** based on the specification. Each step has explicit success conditions and fallback triggers.

### Step 1: Identify Matching Doc-Sets

**Purpose:** Find all `<doc_name>:<doc_version>` doc-sets that match the query intent.

**Method:**
1. Use `ls -1 "{knowledge_base}/"` to list available doc-sets
2. Analyze query intent to identify target domains (e.g., "Claude" â†’ `*Claude*`)
3. Filter doc-sets based on intent keywords using LLM semantic understanding

**Output:** List of matching doc-set names

```python
["Claude_Code_Docs:latest", "Cursor_Docs:v1.0"]
```

**Match Anomaly Handling:**
- If **no doc-sets match** â†’ Report failure immediately: "Target documentation set not found"
- This is a terminal failure - no fallback strategies apply

### Step 2: Identify Matching PageTitles

**Purpose:** Find all `<PageTitle>` directories within matched doc-sets that meet basic relevance threshold (â‰¥0.6).

**Method:**
1. List all `docTOC.md` files in each matched doc-set
2. For each PageTitle, read its `docTOC.md` content
3. Calculate PageTitle relevance score using `calculate_page_title_relevance_score(query, toc_context)`
4. Filter by **basic threshold (0.6)** - only keep PageTitles with score â‰¥ 0.6

**Success Conditions:**
- PageTitle count â‰¥ 1 per doc-set
- At least one PageTitle with precision score (â‰¥ 0.7)

**Fallback Trigger:** If conditions not met â†’ Execute Fallback Strategy 1

### Step 3: Identify Matching Headings (via docTOC.md)

**Purpose:** From filtered PageTitles, find headings that match the query.

**Method:**
1. Read `docTOC.md` files from matched PageTitles
2. Extract all headings using `extract_headings_with_levels()`
3. Score each heading using `calculate_heading_relevance_score()` with **prompt-based retrieval strategy**
4. Filter by basic threshold (â‰¥ 0.6)

**Success Conditions:**
- Heading count â‰¥ 2 per doc-set (across all matched PageTitles)

**Fallback Trigger:** If conditions not met â†’ Execute Fallback Strategy 2

### Step 4: Return Heading Lists

**Purpose:** Return all matching headings with scores and attribution.

**Output Format:**
```markdown
## ç²¾å‡†æ£€ç´¢ç»“æœ

### <PageTitle1>
- ## Heading1 (score) âœ…ç²¾å‡†åŒ¹é…
- ### Heading2 (score)

### <PageTitle2>
- ## Heading3 (score) âœ…ç²¾å‡†åŒ¹é…
```

**CRITICAL:** Output must be based on **heading-level relevance scores**, not PageTitle-level scores. Each heading is evaluated independently.

### Fallback Strategy 1: TOC Content Grep

**Trigger:** Step 2 success conditions not met (PageTitle < 1 OR no precision match)

**Method:**
1. Extract keywords from query using `extract_keywords()`
2. Execute grep across all `docTOC.md` files in matched doc-sets
3. Parse grep results to identify matching headings
4. **Annotate each heading with its PageTitle ownership** using `annotate_headings_with_page_title()`

**Success Conditions:**
- Heading count â‰¥ 2 per doc-set
- All results include PageTitle attribution

**Fallback Trigger:** If conditions not met â†’ Execute Fallback Strategy 2

### Fallback Strategy 2: Content Context Traceback

**Trigger:** Fallback Strategy 1 success conditions not met

**Purpose:** Use docContent.md only as a hint to locate relevant headings in docTOC.md

**Method:**
1. Execute grep across `docContent.md` files **with context only** (`grep -B 10`)
2. **For each match, trace back to the nearest heading** in `docTOC.md` using `traceback_to_heading()`
3. **Discard the content context** - use it only to identify which heading to return
4. **Retry with expanded context if no heading found:**
   - If `grep -B 10` fails to traceback to any heading â†’ Retry with `grep -B 20`
   - If still no heading â†’ Retry with `grep -B 50`
5. Return **only the heading list from docTOC.md**, never docContent content

**CRITICAL:** This strategy must NOT return any docContent.md content. The grep result is a hint, not output.

**Success Conditions:**
- Heading count â‰¥ 2 per doc-set
- All results include PageTitle attribution
- Results contain ONLY docTOC.md headings (no docContent content)

**Fallback Trigger:** If conditions not met â†’ Report failure

## Prompt-based Retrieval Strategy (v4.1.0)

This skill uses **LLM-based semantic evaluation** for heading relevance scoring. The following prompt template guides consistent heading-level relevance assessment.

### Heading Evaluation Prompt Template

```markdown
## Query Analysis
Original Query: {query}
Query Intent: {intent}
Domain Context: {context}

## Heading to Evaluate
Heading Text: {heading_text}
Heading Level: {heading_level}
Parent PageTitle: {page_title}

## Evaluation Criteria (0.0 - 1.0)

### Semantic Relevance (0-1)
- Does the heading directly address the query topic?
- Consider technical terminology and concept alignment

### Intent Alignment (0-1)
- Does the heading serve the user's intent (LEARN/CONFIGURE/TROUBLESHOOT/REFERENCE/COMPARE)?
- Is the scope appropriate (SPECIFIC/GENERAL)?

### Context Appropriateness (0-1)
- Given the PageTitle context, how relevant is this heading?
- Does the heading belong to a related section?

## Scoring Formula
final_score = (semantic_relevance * 0.4) + (intent_alignment * 0.4) + (context_appropriateness * 0.2)

## Output Format
```json
{
  "score": 0.XX,
  "is_basic": true/false,  // >= 0.6
  "is_precision": true/false,  // >= 0.7
  "rationale": "Brief explanation"
}
```

## Examples

| Query | Heading | Score | Rationale |
|-------|---------|-------|-----------|
| "å¦‚ä½•é…ç½® skills" | "Configure Skills" | 0.92 | Direct semantic match, CONFIG intent alignment |
| "å¦‚ä½•é…ç½® skills" | "Write SKILL.md" | 0.85 | Related configuration topic |
| "hooks æ•…éšœæ’é™¤" | "Hook types" | 0.65 | Related but not troubleshooting focus |
| "API å‚è€ƒ" | "Testing best practices" | 0.35 | Different topic entirely |

### Key Principles

1. **Independent Scoring**: Heading-level scores are independent of PageTitle-level scores
2. **Basic Threshold (0.6)**: Minimum score for inclusion in results
3. **Precision Threshold (0.7)**: Minimum score for "ç²¾å‡†åŒ¹é…" marker
4. **Consistency**: Use the same prompt template across all heading evaluations

## Content Language and Structure Constraints

**CRITICAL CONSTRAINTS for search result content:**

1. **Language Consistency:**
   - Output keep the same the Language with source `docTOC.md` docs

2. **Content Structure:**
   - Extract actual markdown headings from docTOC.md using `SearchHelpers.extract_headings_with_levels()`

## Heading-Level Scoring Independence (v4.1.0)

**CRITICAL CONSTRAINT:** Returned heading lists must be based on **heading-level relevance scores**, NOT PageTitle-level scores.

### Why Independence Matters

- A PageTitle may have high relevance (0.85) but contain some low-relevance headings (<0.6)
- A PageTitle may have medium relevance (0.68) but contain highly relevant headings (â‰¥0.8)
- **Results should reflect actual heading relevance**, not inherited PageTitle scores

### Result Filtering

- Filter headings by **heading-level basic threshold (0.6)**
- Mark precision by **heading-level precision threshold (0.7)**
- Group results by PageTitle for readability
- Show individual heading scores in output

## è¾“å‡ºæ ·ä¾‹æ ¼å¼ (Output Example Format)

```markdown
=== AOP-FINAL | agent=md-doc-searcher | results=5 | doc_sets=Claude_Code_Docs:latest ===
**Pass through EXACTLY as-is** â€” NO summarizing, NO rephrasing, NO commentary

## æ£€ç´¢ç»“æœæ‘˜è¦
- æ–‡æ¡£é›†æ•°é‡: 1
- åŒ¹é…PageTitleæ€»æ•°: 5
- åŒ¹é…Headingæ€»æ•°: 12
- ç²¾å‡†åŒ¹é…(â‰¥0.7)æ•°é‡: 4

## ç²¾å‡†æ£€ç´¢ç»“æœ (Intent-Filtered Results)

### é«˜ç›¸å…³æ€§æ–‡æ¡£ (High Relevance â‰¥0.8)

**Claude_Code_Docs:latest**

**Agent Skills** - PageTitleç›¸å…³æ€§: 0.92 âœ…ç²¾å‡†åŒ¹é…
   - æ„å›¾åŒ¹é…: ç›´æ¥å›ç­”ç”¨æˆ·å…³äºæŠ€èƒ½é…ç½®çš„éœ€æ±‚
   - TOC è·¯å¾„: `{knowledge_base}/Claude_Code_Docs:latest/Agent Skills/docTOC.md`
   - **åŒ¹é…Headingåˆ—è¡¨**:
     - ## 1. Create your first Skill (0.92) âœ…ç²¾å‡†åŒ¹é…
     - ### 1.1. Where Skills live (0.88) âœ…ç²¾å‡†åŒ¹é…
     - ## 2. Configure Skills (0.85) âœ…ç²¾å‡†åŒ¹é…
     - ### 2.1. Write SKILL.md (0.78)
   - **åŒ¹é…ç»Ÿè®¡**: PageTitleâ‰¥2ä¸ª âœ…, Headingâ‰¥2ä¸ª âœ…, ç²¾å‡†åŒ¹é…â‰¥1ä¸ª âœ…

**Get started with Claude Code hooks** - PageTitleç›¸å…³æ€§: 0.84 âœ…ç²¾å‡†åŒ¹é…
   - æ„å›¾åŒ¹é…: æä¾›hooksè®¾ç½®çš„å…¥é—¨æŒ‡å¯¼
   - TOC è·¯å¾„: `{knowledge_base}/Claude_Code_Docs:latest/Get started with Claude Code hooks/docTOC.md`
   - **åŒ¹é…Headingåˆ—è¡¨**:
     - ## 1. Introduction to hooks (0.86) âœ…ç²¾å‡†åŒ¹é…
     - ## 2. Basic configuration (0.82) âœ…ç²¾å‡†åŒ¹é…
     - ### 2.1. Hook types (0.75)
   - **åŒ¹é…ç»Ÿè®¡**: PageTitleâ‰¥2ä¸ª âœ…, Headingâ‰¥2ä¸ª âœ…, ç²¾å‡†åŒ¹é…â‰¥1ä¸ª âœ…

### ä¸­ç­‰ç›¸å…³æ€§æ–‡æ¡£ (Medium Relevance 0.6-0.79)

**Claude_Code_Docs:latest**

**Testing best practices** - PageTitleç›¸å…³æ€§: 0.68
   - æ„å›¾åŒ¹é…: æä¾›æµ‹è¯•ç›¸å…³çš„ä¸Šä¸‹æ–‡ä¿¡æ¯
   - æ³¨æ„: é€šç”¨æµ‹è¯•ä¸Šä¸‹æ–‡ï¼Œéhooksä¸“ç”¨
   - TOC è·¯å¾„: `{knowledge_base}/Claude_Code_Docs:latest/Testing best practices/docTOC.md`
   - **åŒ¹é…Headingåˆ—è¡¨**:
     - ## Testing with hooks (0.72)
     - ### Hook testing strategies (0.65)
   - **åŒ¹é…ç»Ÿè®¡**: PageTitleâ‰¥2ä¸ª âœ…, Headingâ‰¥2ä¸ª âœ…, ç²¾å‡†åŒ¹é…â‰¥1ä¸ª âŒ

### å·²è¿‡æ»¤æ–‡æ¡£ (Filtered Out <0.5)

**Claude_Code_Docs:latest**
- "Claude Code overview" - åŸå› : å¯¹äºå…·ä½“é…ç½®æŸ¥è¯¢è¿‡äºå®½æ³›
- "API reference" - åŸå› : ä¸åŒä¸»é¢˜ (API vs é…ç½®)

---

## åŒ¹é…ç»Ÿè®¡ (æŒ‰æ–‡æ¡£é›†)

- **Claude_Code_Docs:latest**:
  - PageTitleåŒ¹é…: 5/1 âœ…
  - HeadingåŒ¹é…: 12/2 âœ…
  - ç²¾å‡†åŒ¹é…: 4/1 âœ…
  - æ•´ä½“çŠ¶æ€: âœ… é€šè¿‡

---

### æ–‡æ¡£æ¥æº (Sources)

1. **Agent Skills**
   - æ–‡æ¡£é›†: Claude_Code_Docs:latest
   - åŸæ–‡é“¾æ¥: https://code.claude.com/docs/en/agent-skills
   - TOC è·¯å¾„: `{knowledge_base}/Claude_Code_Docs:latest/Agent Skills/docTOC.md`

2. **Get started with Claude Code hooks**
   - æ–‡æ¡£é›†: Claude_Code_Docs:latest
   - åŸæ–‡é“¾æ¥: https://code.claude.com/docs/en/get-started-hooks
   - TOC è·¯å¾„: `{knowledge_base}/Claude_Code_Docs:latest/Get started with Claude Code hooks/docTOC.md`

3. **Testing best practices**
   - æ–‡æ¡£é›†: Claude_Code_Docs:latest
   - åŸæ–‡é“¾æ¥: https://code.claude.com/docs/en/testing-best-practices
   - TOC è·¯å¾„: `{knowledge_base}/Claude_Code_Docs:latest/Testing best practices/docTOC.md`

**Coverage:**
- âœ… Covered: é…ç½®æ–¹æ³•, å…¥é—¨æŒ‡å¯¼, åŸºæœ¬è®¾ç½®, æµ‹è¯•ç­–ç•¥
- âš ï¸  Partially covered: é«˜çº§é…ç½®æ¨¡å¼
- âŒ Not covered: æ€§èƒ½ä¼˜åŒ–, æ•…éšœæ’é™¤
- ğŸ’¡ Suggestion: æœç´¢ 'hooks troubleshooting' è·å–æ•…éšœæ’é™¤ä¿¡æ¯

=== END-AOP-FINAL ===
```

### æ ·ä¾‹è¯´æ˜ (Example Explanation) (v4.0.0)

å®Œæ•´è¾“å‡ºæ ·ä¾‹åŒ…å«ï¼š
- åˆ†å±‚ç»“æœï¼ˆAOP-FINALæ ‡è®°ï¼‰
- æ„å›¾è¿‡æ»¤
- **æ˜ç¡®çš„å½’å±æ ‡æ³¨**ï¼šæ¯ä¸ª Heading éƒ½å½’å±äºç‰¹å®šçš„ `<doc_name>:<doc_version>` å’Œ `<PageTitle>`
- **æŒ‰æ–‡æ¡£é›†åˆ†ç»„çš„åŒ¹é…Headingåˆ—è¡¨**ï¼ˆå¸¦è¯„åˆ†å’Œç²¾å‡†æ ‡è®°ï¼‰
- **æŒ‰æ–‡æ¡£é›†åˆ†ç»„çš„åŒ¹é…ç»Ÿè®¡**
- è¿‡æ»¤æ€»ç»“
- æ¥æºä¿¡æ¯
- è¦†ç›–åº¦åˆ†æ

## Return Format Requirements (v4.0.0)

### AOP-FINAL Output Format

**CRITICAL:** All final search results MUST be wrapped with AOP-FINAL markers to prevent modification by the main session AI.

**CRITICAL: Grouping Requirement**
All headings MUST be organized with explicit ownership hierarchy:

```
<doc_name>:<doc_version>
  â””â”€â”€ <PageTitle>
        â””â”€â”€ ## Heading1 (score) âœ…ç²¾å‡†åŒ¹é…
        â””â”€â”€ ### Heading2 (score)
```

Every heading must clearly show:
1. Which `<doc_name>:<doc_version>` it belongs to
2. Which `<PageTitle>` (directory) it belongs to

```markdown
=== AOP-FINAL | agent=md-doc-searcher | results={count} | doc_sets={sets} ===
**Pass through EXACTLY as-is** â€” NO summarizing, NO rephrasing, NO commentary

## æ£€ç´¢ç»“æœæ‘˜è¦
[Summary with page_title_count, heading_count, precision_count, doc_set_count]

## ç²¾å‡†æ£€ç´¢ç»“æœ
[<doc_name>:<doc_version>]
  â””â”€â”€ [<PageTitle>]
        â””â”€â”€ ## Heading1 (score) âœ…ç²¾å‡†åŒ¹é…
        â””â”€â”€ ### Heading2 (score)

## åŒ¹é…ç»Ÿè®¡ (æŒ‰æ–‡æ¡£é›†)
[Statistics by doc-set]

---

### æ–‡æ¡£æ¥æº (Sources)
[Sources section with original URLs and TOC paths]

**Coverage:**
[Coverage analysis]
=== END-AOP-FINAL ===
```

**Required Attributes:**
- `agent=md-doc-searcher` - Identifies this skill as the source
- `results={count}` - Total number of PageTitles found
- `doc_sets={sets}` - Documentation sets searched (comma-separated)
- **Grouping Requirement**: Every heading must show explicit `<doc_name>:<doc_version>` and `<PageTitle>` ownership

### Sources Format (ALWAYS REQUIRED)

**CRITICAL:** You MUST include a **Sources** section at the end of ALL search results.

**Required Format:**
```markdown
---

### æ–‡æ¡£æ¥æº (Sources)

1. **Document Title**
   - æ–‡æ¡£é›†: <doc_name>:<doc_version>
   - åŸæ–‡é“¾æ¥: https://original-url.com/docs/page
   - TOC è·¯å¾„: `{knowledge_base}/<doc_name>:<doc_version>/<PageTitle>/docTOC.md`
```

### Match Statistics Format

```markdown
## åŒ¹é…ç»Ÿè®¡ (æŒ‰æ–‡æ¡£é›†)

- **<doc_set_name>**:
  - PageTitleåŒ¹é…: X/Y âœ…
  - HeadingåŒ¹é…: X/Y âœ…
  - ç²¾å‡†åŒ¹é…: X/1 âœ…
  - æ•´ä½“çŠ¶æ€: âœ… é€šè¿‡
```

### Coverage Format

```markdown
**Coverage:**
- âœ… Covered: [aspects covered by results]
- âš ï¸  Partially covered: [aspects partially covered]
- âŒ Not covered: [aspects that may exist in other documents/sets]
- ğŸ’¡ Suggestion: [if applicable, suggest other searches]
```

## Output Prohibition

AOP-FINAL output must be returned EXACTLY as received â€” NO summarizing, rephrasing, commentary, or reformatting. The AOP-FINAL marker preserves integrity of document paths, coverage analysis, and source attribution.

## Output Validation Checklist

**Before returning results, verify:**

- [ ] Results contain ONLY docTOC.md headings (no docContent.md paragraphs)
- [ ] No docContent.md file paths appear in output (except Sources section with docTOC.md paths)
- [ ] All returned content originates from docTOC.md files
- [ ] If grep was used on docContent.md, context was discarded after heading traceback
- [ ] AOP-FINAL markers are present and correctly formatted
- [ ] **Grouping verification:**
  - [ ] Every heading has explicit `<doc_name>:<doc_version>` attribution
  - [ ] Every heading has explicit `<PageTitle>` attribution
  - [ ] Results are organized by doc_set â†’ PageTitle â†’ headings hierarchy
  - [ ] No orphan headings (headings without clear ownership)

**Common violations to avoid:**
- âŒ "Based on the content found in docContent.md..."
- âŒ Returning a paragraph from docContent.md as evidence
- âŒ Using Read tool to load docContent.md content
- âŒ Including docContent.md file paths in results (except Sources docTOC.md paths)
- âŒ Flat list of headings without doc_set and PageTitle grouping
- âŒ Headings that don't clearly show which doc_set/PageTitle they belong to

## Error Handling

If a document cannot be found: state clearly which was not found, suggest alternatives, try progressive fallback. **If no results meet success conditions after all fallbacks, report failure immediately.**

**Failure Report Format:**
```markdown
=== AOP-FINAL | agent=md-doc-searcher | results=0 | doc_sets=X ===

**æ£€ç´¢å¤±è´¥** - æœªæ‰¾åˆ°æ»¡è¶³æˆåŠŸæ¡ä»¶çš„æ–‡æ¡£

**å°è¯•çš„æ£€ç´¢ç­–ç•¥:**
1. Level 1: è¯­ä¹‰æ ‡é¢˜åŒ¹é… - æœªæ»¡è¶³ PageTitleâ‰¥1 æˆ– ç²¾å‡†åŒ¹é…è¦æ±‚
2. Level 2: TOCå†…å®¹grepæœç´¢ - æœªæ»¡è¶³ Headingâ‰¥2 è¦æ±‚
3. Level 3: å…¨æ–‡å†…å®¹æœç´¢ (å«é‡è¯•):
   - grep -B 10: æœªæ‰¾åˆ° heading
   - grep -B 20: æœªæ‰¾åˆ° heading
   - grep -B 50: æœªæ‰¾åˆ° heading
   - æœªèƒ½å›æº¯åˆ°ä»»ä½•æœ‰æ•ˆ heading

**å¯èƒ½åŸå› :**
- ç›®æ ‡æ–‡æ¡£é›†ä¸å­˜åœ¨: [ç¼ºå¤±çš„æ–‡æ¡£é›†]
- æ–‡æ¡£åº“ä¸­ç¼ºå°‘ç›¸å…³å†…å®¹
- æŸ¥è¯¢å…³é”®è¯è¿‡äºç‰¹å®š

**å»ºè®®:**
- ç¡®è®¤ç›®æ ‡æ–‡æ¡£é›†åç§°æ˜¯å¦æ­£ç¡®
- å°è¯•ä½¿ç”¨æ›´å®½æ³›çš„æŸ¥è¯¢å…³é”®è¯
- ç¡®è®¤æ–‡æ¡£åº“æ˜¯å¦åŒ…å«ç›¸å…³å†…å®¹

=== END-AOP-FINAL ===
```

## Knowledge Base Path Configuration

**CRITICAL:** All document paths in this skill use `{knowledge_base}` as a placeholder that MUST be resolved from the configuration file.

### Configuration File Location
```
.claude/knowledge_base.json
```

### Configuration Format
```json
{
  "knowledge_base": {
    "base_dir": "~/project/md_docs_base"
  }
}
```

## Bash Tool Timeout

When using Bash for file operations: always specify `timeout` parameter (recommended: 30000ms). Use `run_in_background: true` for long-running operations.

## Detailed Reference

- **SearchHelpers API:** `reference/search-helpers-api.md` - Semantic retrieval function reference
