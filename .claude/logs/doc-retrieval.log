  "permission": {{
    "skill": {{
      "*": "allow",
      "pr-review": "allow",
      "internal-*": "deny",
      "experimental-*": "ask"
    }}
  }}
}}
```

| 权限 | 行为 |
|------|------|
| `allow` | 立即加载 skill |
| `deny` | 对代理隐藏，访问被拒绝 |
| `ask` | 加载前提示用户批准 |

支持通配符模式：`internal-*` 匹配 `internal-docs`、`internal-tools` 等。

### 5.2 为特定 Agent 覆盖权限

**自定义 Agent**（在 frontmatter 中）：

```yaml
---
permission:
  skill:
    "documents-*": allow
---
```

**内置 Agent**（在 `opencode.json` 中）：

```json
{{
  "agent": {{
    "plan": {{
      "permission": {{
        "skill": {{
          "internal-*": "allow"
        }}
      }}
    }}
  }}
}}
```

### 5.3 禁用 Skill 工具

**自定义 Agent**：

```yaml
---
tools:
  skill: false
---
```

**内置 Agent**：

```json
{{
  "agent": {{
    "plan": {{
      "tools": {{
        "skill": false
      }}
    }}
  }}
}}
```

禁用后，`<available_skills>` 部分将完全省略。

---

## 六、故障排除

如果 skill 没有显示，请检查：

1. 验证 `SKILL.md` 是否全大写拼写
2. 检查 frontmatter 是否包含 `name` 和 `description`
3. 确保 skill 名称在所有位置唯一
4. 检查权限（`deny` 的 skill 对代理隐藏）

---

### 文档来源 (Sources)

1. **Agent Skills**
   - 原文链接: https://opencode.ai/docs/skills
   - 路径: `/Users/zorro/project/md_docs_base/OpenCode_Docs@latest/Agent Skills/docContent.md`
"""

# 打印 AOP-FINAL 输出
print(f"=== AOP-FINAL | agent=doc-retriever | format=markdown | lines=85 | source=OpenCode_Docs@latest ===")
print(output)
print("=== END-AOP-FINAL ===")
EOF
[2026-01-24 23:06:17] Document extraction detected: python3 << 'EOF'
import json

# Phase 0b output
scene = "how_to"
routing_params = {
    "confidence": 0.85,
    "ambiguity": 0.2,
    "coverage_need": 0.6,
    "reranker_threshold": 0.71
}

# 文档内容 (Agent Skills)
processed_doc = """# Agent Skills

> **原文链接**: https://opencode.ai/docs/skills

---

# Agent Skills

Define reusable behavior via SKILL.md definitions

Agent skills let OpenCode discover reusable instructions from your repo or home directory. Skills are loaded on-demand via the native `skill` tool—agents see available skills and can load the full content when needed.

* * *

## Place files

Create one folder per skill name and put a `SKILL.md` inside it. OpenCode searches these locations:

- Project config: `.opencode/skills/<name>/SKILL.md`
- Global config: `~/.config/opencode/skills/<name>/SKILL.md`
- Project Claude-compatible: `.claude/skills/<name>/SKILL.md`
- Global Claude-compatible: `~/.claude/skills/<name>/SKILL.md`

* * *

## Understand discovery

For project-local paths, OpenCode walks up from your current working directory until it reaches the git worktree. It loads any matching `skills/*/SKILL.md` in `.opencode/` and any matching `.claude/skills/*/SKILL.md` along the way.

Global definitions are also loaded from `~/.config/opencode/skills/*/SKILL.md` and `~/.claude/skills/*/SKILL.md`.

* * *

## Write frontmatter

Each `SKILL.md` must start with YAML frontmatter. Only these fields are recognized:

- `name` (required)
- `description` (required)
- `license` (optional)
- `compatibility` (optional)
- `metadata` (optional, string-to-string map)

Unknown frontmatter fields are ignored.

* * *

## Validate names

`name` must:

- Be 1-64 characters
- Be lowercase alphanumeric with single hyphen separators
- Not start or end with `-`
- Not contain consecutive `--`
- Match the directory name that contains `SKILL.md`

Equivalent regex:
`^[a-z0-9]+(-[a-z0-9]+)*$`

* * *

## Follow length rules

`description` must be 1-1024 characters. Keep it specific enough for the agent to choose correctly.

* * *

## Use an example

Create `.opencode/skills/git-release/SKILL.md` like this:

```
---
name: git-release
description: Create consistent releases and changelogs
license: MIT
compatibility: opencode
metadata:
  audience: maintainers
  workflow: github
---

## What I do

- Draft release notes from merged PRs
- Propose a version bump
- Provide a copy-pasteable `gh release create` command

## When to use me

Use this when you are preparing a tagged release.
Ask clarifying questions if the target versioning scheme is unclear.
```

* * *

## Recognize tool description

OpenCode lists available skills in the `skill` tool description. Each entry includes the skill name and description:

```
<available_skills>
  <skill>
    <name>git-release</name>
    <description>Create consistent releases and changelogs</description>
  </skill>
</available_skills>
```

The agent loads a skill by calling the tool:

```
skill({ name: "git-release" })
```

* * *

## Configure permissions

Control which skills agents can access using pattern-based permissions in `opencode.json`:

```json
{
  "permission": {
    "skill": {
      "*": "allow",
      "pr-review": "allow",
      "internal-*": "deny",
      "experimental-*": "ask"
    }
  }
}
```

Permission | Behavior
---|---
`allow` | Skill loads immediately
`deny` | Skill hidden from agent, access rejected
`ask` | User prompted for approval before loading

Patterns support wildcards: `internal-*` matches `internal-docs`, `internal-tools`, etc.

* * *

## Override per agent

Give specific agents different permissions than the global defaults.

**For custom agents** (in agent frontmatter):

```yaml
---
permission:
  skill:
    "documents-*": allow
---
```

**For built-in agents** (in `opencode.json`):

```json
{
  "agent": {
    "plan": {
      "permission": {
        "skill": {
          "internal-*": "allow"
        }
      }
    }
  }
}
```

* * *

## Disable the skill tool

Completely disable skills for agents that should not use them:

**For custom agents**:

```yaml
---
tools:
  skill: false
---
```

**For built-in agents**:

```json
{
  "agent": {
    "plan": {
      "tools": {
        "skill": false
      }
    }
  }
}
```

When disabled, the `<available_skills>` section is omitted entirely.

* * *

## Troubleshoot loading

If a skill does not show up:

1. Verify `SKILL.md` is spelled in all caps
2. Check that frontmatter includes `name` and `description`
3. Ensure skill names are unique across all locations
4. Check permissions-skills with `deny` are hidden from agents
"""

doc_meta = {
    "title": "Agent Skills",
    "source_url": "https://opencode.ai/docs/skills",
    "local_path": "/Users/zorro/project/md_docs_base/OpenCode_Docs@latest/Agent Skills/docContent.md"
}

# Phase 4: Scene-Based Output (how_to scene)
output = f"""# OpenCode Agent Skills 创建指南

## 概述

Agent Skills 允许 OpenCode 从你的仓库或主目录发现可复用的指令。Skills 通过原生的 `skill` 工具按需加载，代理可以看到可用的技能，并在需要时加载完整内容。

---

## 一、创建 Skills 文件

### 1.1 文件位置

为每个 skill 创建一个文件夹，并在其中放置 `SKILL.md` 文件。OpenCode 会在以下位置搜索：

| 类型 | 路径 |
|------|------|
| 项目配置 | `.opencode/skills/<name>/SKILL.md` |
| 全局配置 | `~/.config/opencode/skills/<name>/SKILL.md` |
| Claude 兼容（项目） | `.claude/skills/<name>/SKILL.md` |
| Claude 兼容（全局） | `~/.claude/skills/<name>/SKILL.md` |

### 1.2 搜索规则

- **项目路径**：OpenCode 从当前工作目录向上遍历，直到到达 git 工作树
- **全局定义**：从 `~/.config/opencode/skills/*/SKILL.md` 和 `~/.claude/skills/*/SKILL.md` 加载

---

## 二、编写 SKILL.md 文件

### 2.1 YAML Frontmatter 必需字段

每个 `SKILL.md` 必须以 YAML frontmatter 开头，支持以下字段：

| 字段 | 必填 | 说明 |
|------|------|------|
| `name` | 是 | Skill 名称 |
| `description` | 是 | 描述（1-1024字符） |
| `license` | 否 | 许可证 |
| `compatibility` | 否 | 兼容性 |
| `metadata` | 否 | 元数据键值对 |

### 2.2 名称验证规则

`name` 必须满足：

- 长度：1-64 字符
- 格式：小写字母和数字，使用单连字符分隔
- 禁止：以 `-` 开头或结尾，禁止连续 `--`
- 必须：与包含 `SKILL.md` 的目录名称匹配

**正则表达式**：`^[a-z0-9]+(-[a-z0-9]+)*$`

---

## 三、完整示例

创建 `.opencode/skills/git-release/SKILL.md`：

```yaml
---
name: git-release
description: Create consistent releases and changelogs
license: MIT
compatibility: opencode
metadata:
  audience: maintainers
  workflow: github
---

## What I do

- Draft release notes from merged PRs
- Propose a version bump
- Provide a copy-pasteable `gh release create` command

## When to use me

Use this when you are preparing a tagged release.
Ask clarifying questions if the target versioning scheme is unclear.
```

---

## 四、Skill 加载与使用

### 4.1 可用技能列表

OpenCode 在 `skill` 工具描述中列出可用的技能，每个条目包含技能名称和描述：

```xml
<available_skills>
  <skill>
    <name>git-release</name>
    <description>Create consistent releases and changelogs</description>
  </skill>
</available_skills>
```

### 4.2 加载 Skill

代理通过调用工具加载 skill：

```python
skill({{ name: "git-release" }})
```

---

## 五、权限配置

### 5.1 全局权限控制

在 `opencode.json` 中使用基于模式的权限控制：

```json
{{
  "permission": {{
    "skill": {{
      "*": "allow",
      "pr-review": "allow",
      "internal-*": "deny",
      "experimental-*": "ask"
    }}
  }}
}}
```

| 权限 | 行为 |
|------|------|
| `allow` | 立即加载 skill |
| `deny` | 对代理隐藏，访问被拒绝 |
| `ask` | 加载前提示用户批准 |

支持通配符模式：`internal-*` 匹配 `internal-docs`、`internal-tools` 等。

### 5.2 为特定 Agent 覆盖权限

**自定义 Agent**（在 frontmatter 中）：

```yaml
---
permission:
  skill:
    "documents-*": allow
---
```

**内置 Agent**（在 `opencode.json` 中）：

```json
{{
  "agent": {{
    "plan": {{
      "permission": {{
        "skill": {{
          "internal-*": "allow"
        }}
      }}
    }}
  }}
}}
```

### 5.3 禁用 Skill 工具

**自定义 Agent**：

```yaml
---
tools:
  skill: false
---
```

**内置 Agent**：

```json
{{
  "agent": {{
    "plan": {{
      "tools": {{
        "skill": false
      }}
    }}
  }}
}}
```

禁用后，`<available_skills>` 部分将完全省略。

---

## 六、故障排除

如果 skill 没有显示，请检查：

1. 验证 `SKILL.md` 是否全大写拼写
2. 检查 frontmatter 是否包含 `name` 和 `description`
3. 确保 skill 名称在所有位置唯一
4. 检查权限（`deny` 的 skill 对代理隐藏）

---

### 文档来源 (Sources)

1. **Agent Skills**
   - 原文链接: https://opencode.ai/docs/skills
   - 路径: `/Users/zorro/project/md_docs_base/OpenCode_Docs@latest/Agent Skills/docContent.md`
"""

# 打印 AOP-FINAL 输出
print(f"=== AOP-FINAL | agent=doc-retriever | format=markdown | lines=85 | source=OpenCode_Docs@latest ===")
print(output)
print("=== END-AOP-FINAL ===")
EOF
[2026-01-24 23:06:28] doc-retriever: Bash tool used
[2026-01-24 23:06:28] Command: python3 -c "
output = '''# OpenCode Agent Skills 创建指南

## 概述

Agent Skills 允许 OpenCode 从你的仓库或主目录发现可复用的指令。Skills 通过原生的 skill 工具按需加载。

---

## 一、创建 Skills 文件

### 1.1 文件位置

为每个 skill 创建一个文件夹，并放置 SKILL.md 文件。OpenCode 搜索以下位置：

- 项目配置: .opencode/skills/<name>/SKILL.md
- 全局配置: ~/.config/opencode/skills/<name>/SKILL.md
- Claude 兼容（项目）: .claude/skills/<name>/SKILL.md
- Claude 兼容（全局）: ~/.claude/skills/<name>/SKILL.md

### 1.2 搜索规则

- 项目路径：从当前目录向上遍历到 git 工作树
- 全局定义：从 ~/.config/opencode/skills/*/SKILL.md 加载

---

## 二、编写 SKILL.md

### 2.1 YAML Frontmatter 必需字段

每个 SKILL.md 必须以 YAML frontmatter 开头：

| 字段 | 必填 | 说明 |
|------|------|------|
| name | 是 | Skill 名称 |
| description | 是 | 描述（1-1024字符） |
| license | 否 | 许可证 |
| compatibility | 否 | 兼容性 |
| metadata | 否 | 元数据键值对 |

### 2.2 名称验证规则

name 必须满足：
- 长度：1-64 字符
- 格式：小写字母数字，单连字符分隔
- 禁止：以 - 开头/结尾，禁止连续 --
- 必须：与目录名称匹配

正则：^[a-z0-9]+(-[a-z0-9]+)*$

---

## 三、完整示例

创建 .opencode/skills/git-release/SKILL.md：

---
name: git-release
description: Create consistent releases and changelogs
license: MIT
compatibility: opencode
metadata:
  audience: maintainers
  workflow: github
---

## What I do

- Draft release notes from merged PRs
- Propose a version bump
- Provide a copy-pasteable gh release create command

## When to use me

Use this when you are preparing a tagged release.

---

## 四、权限配置

在 opencode.json 中配置：

{
  \"permission\": {
    \"skill\": {
      \"*\": \"allow\",
      \"pr-review\": \"allow\",
      \"internal-*\": \"deny\",
      \"experimental-*\": \"ask\"
    }
  }
}

| 权限 | 行为 |
|------|------|
| allow | 立即加载 |
| deny | 对代理隐藏 |
| ask | 提示用户批准 |

---

## 五、故障排除

如果 skill 没有显示：
1. 验证 SKILL.md 全大写拼写
2. 检查包含 name 和 description
3. 确保名称唯一
4. 检查权限设置

---

### 文档来源 (Sources)

1. **Agent Skills**
   - 原文链接: https://opencode.ai/docs/skills
   - 路径: /Users/zorro/project/md_docs_base/OpenCode_Docs@latest/Agent Skills/docContent.md
'''

print('=== AOP-FINAL | agent=doc-retriever | format=markdown | lines=65 | source=OpenCode_Docs@latest ===')
print(output)
print('=== END-AOP-FINAL ===')
"
[2026-01-24 23:06:28] Document extraction detected: python3 -c "
output = '''# OpenCode Agent Skills 创建指南

## 概述

Agent Skills 允许 OpenCode 从你的仓库或主目录发现可复用的指令。Skills 通过原生的 skill 工具按需加载。

---

## 一、创建 Skills 文件

### 1.1 文件位置

为每个 skill 创建一个文件夹，并放置 SKILL.md 文件。OpenCode 搜索以下位置：

- 项目配置: .opencode/skills/<name>/SKILL.md
- 全局配置: ~/.config/opencode/skills/<name>/SKILL.md
- Claude 兼容（项目）: .claude/skills/<name>/SKILL.md
- Claude 兼容（全局）: ~/.claude/skills/<name>/SKILL.md

### 1.2 搜索规则

- 项目路径：从当前目录向上遍历到 git 工作树
- 全局定义：从 ~/.config/opencode/skills/*/SKILL.md 加载

---

## 二、编写 SKILL.md

### 2.1 YAML Frontmatter 必需字段

每个 SKILL.md 必须以 YAML frontmatter 开头：

| 字段 | 必填 | 说明 |
|------|------|------|
| name | 是 | Skill 名称 |
| description | 是 | 描述（1-1024字符） |
| license | 否 | 许可证 |
| compatibility | 否 | 兼容性 |
| metadata | 否 | 元数据键值对 |

### 2.2 名称验证规则

name 必须满足：
- 长度：1-64 字符
- 格式：小写字母数字，单连字符分隔
- 禁止：以 - 开头/结尾，禁止连续 --
- 必须：与目录名称匹配

正则：^[a-z0-9]+(-[a-z0-9]+)*$

---

## 三、完整示例

创建 .opencode/skills/git-release/SKILL.md：

---
name: git-release
description: Create consistent releases and changelogs
license: MIT
compatibility: opencode
metadata:
  audience: maintainers
  workflow: github
---

## What I do

- Draft release notes from merged PRs
- Propose a version bump
- Provide a copy-pasteable gh release create command

## When to use me

Use this when you are preparing a tagged release.

---

## 四、权限配置

在 opencode.json 中配置：

{
  \"permission\": {
    \"skill\": {
      \"*\": \"allow\",
      \"pr-review\": \"allow\",
      \"internal-*\": \"deny\",
      \"experimental-*\": \"ask\"
    }
  }
}

| 权限 | 行为 |
|------|------|
| allow | 立即加载 |
| deny | 对代理隐藏 |
| ask | 提示用户批准 |

---

## 五、故障排除

如果 skill 没有显示：
1. 验证 SKILL.md 全大写拼写
2. 检查包含 name 和 description
3. 确保名称唯一
4. 检查权限设置

---

### 文档来源 (Sources)

1. **Agent Skills**
   - 原文链接: https://opencode.ai/docs/skills
   - 路径: /Users/zorro/project/md_docs_base/OpenCode_Docs@latest/Agent Skills/docContent.md
'''

print('=== AOP-FINAL | agent=doc-retriever | format=markdown | lines=65 | source=OpenCode_Docs@latest ===')
print(output)
print('=== END-AOP-FINAL ===')
"
[2026-01-24 23:06:41] doc-retriever session ended: 8d57ffce-ed90-4a5f-a629-9370f21e8b3e (status: completed)
