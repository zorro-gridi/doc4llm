from doc4llm.tool.md_doc_retrieval import BM25Matcher
import json

# Read knowledge base config
import json as json_lib
with open('/Users/zorro/project/doc4llm/.claude/knowledge_base.json', 'r') as f:
    kb_config = json_lib.load(f)
    base_dir = kb_config['knowledge_base']['base_dir'].replace('~', '/Users/zorro')

# Initialize BM25 matcher
matcher = BM25Matcher(base_dir=base_dir)

# Search for multiple queries related to skills

for query in queries:
    result = matcher.search(query, k=5)
    if result.get('matches'):
        results.extend(result['matches'])

# Remove duplicates and sort by score
for r in results:
    key = (r['doc_set'], r['page_title'])
    if key not in unique_results or r['score'] > unique_results[key]['score']:
        unique_results[key] = r

# Output as JSON
output = {
    'results': [
            'headings': r.get('headings', [])
        for r in sorted(unique_results.values(), key=lambda x: -x['score'])

print(json.dumps(output, indent=2))
from doc4llm.tool.md_doc_retrieval import BM25Matcher
import json

# Read knowledge base config
import json as json_lib
with open('/Users/zorro/project/doc4llm/.claude/knowledge_base.json', 'r') as f:
    kb_config = json_lib.load(f)
    base_dir = kb_config['knowledge_base']['base_dir'].replace('~', '/Users/zorro')

# Initialize BM25 matcher
matcher = BM25Matcher(base_dir=base_dir)

# Search for multiple queries related to skills

for query in queries:
    result = matcher.search(query, k=5)
    if result.get('matches'):
        results.extend(result['matches'])

# Remove duplicates and sort by score
for r in results:
    key = (r['doc_set'], r['page_title'])
    if key not in unique_results or r['score'] > unique_results[key]['score']:
        unique_results[key] = r

# Output as JSON
output = {
    'results': [
            'headings': r.get('headings', [])
        for r in sorted(unique_results.values(), key=lambda x: -x['score'])

print(json.dumps(output, indent=2))
import sys
sys.path.insert(0, '/Users/zorro/project/doc4llm')
from doc4llm.tool.md_doc_retrieval import MarkdownDocExtractor
import json

# Read knowledge base config
with open('/Users/zorro/project/doc4llm/.claude/knowledge_base.json', 'r') as f:
    kb_config = json.load(f)
    base_dir = kb_config['knowledge_base']['base_dir'].replace('~', '/Users/zorro')

# Create extractor
extractor = MarkdownDocExtractor(base_dir=base_dir)

# Check method exists
print('Has extract_by_headings:', hasattr(extractor, 'extract_by_headings'))
print('Methods with extract:', [m for m in dir(extractor) if 'extract' in m])

# Try section extraction
sections = extractor.extract_by_headings(
    doc_set='Claude_Code_Docs@latest'
)

print('\\nExtracted sections:')
for heading, content in sections.items():
    print(f'=== {heading} ===')
    print(f'Content length: {len(content)} chars')
import sys
sys.path.insert(0, '/Users/zorro/project/doc4llm')
from doc4llm.tool.md_doc_retrieval import MarkdownDocExtractor
import json

# Read knowledge base config
with open('/Users/zorro/project/doc4llm/.claude/knowledge_base.json', 'r') as f:
    kb_config = json.load(f)
    base_dir = kb_config['knowledge_base']['base_dir'].replace('~', '/Users/zorro')

# Create extractor
extractor = MarkdownDocExtractor(base_dir=base_dir)

# Check method exists
print('Has extract_by_headings:', hasattr(extractor, 'extract_by_headings'))
print('Methods with extract:', [m for m in dir(extractor) if 'extract' in m])

# Try section extraction
sections = extractor.extract_by_headings(
    doc_set='Claude_Code_Docs@latest'
)

print('\\nExtracted sections:')
for heading, content in sections.items():
    print(f'=== {heading} ===')
    print(f'Content length: {len(content)} chars')
import sys
sys.path.insert(0, '.')
from doc4llm.tool.md_doc_retrieval import MarkdownDocExtractor
import json

# Initialize extractor
extractor = MarkdownDocExtractor()

# Read knowledge base config
with open('.claude/knowledge_base.json', 'r') as f:
    kb_config = json.load(f)
    base_dir = kb_config.get('base_dir', 'md_docs')

print(f'Knowledge base directory: {base_dir}')
print(f'Doc sets configured: {list(kb_config.get(\"doc_sets\", {}).keys())}')
import sys
sys.path.insert(0, '.')
from doc4llm.tool.md_doc_retrieval import MarkdownDocExtractor
import json

# Initialize extractor
extractor = MarkdownDocExtractor()

# Read knowledge base config
with open('.claude/knowledge_base.json', 'r') as f:
    kb_config = json.load(f)
    base_dir = kb_config.get('base_dir', 'md_docs')

print(f'Knowledge base directory: {base_dir}')
print(f'Doc sets configured: {list(kb_config.get(\"doc_sets\", {}).keys())}')
import sys
sys.path.insert(0, '.')
from doc4llm.tool.md_doc_retrieval import MarkdownDocExtractor

extractor = MarkdownDocExtractor()
result = extractor.extract_by_titles_with_metadata(['Agent Skills'], threshold=2100)

print(f'Total lines: {result.total_line_count}')
print(f'Requires processing: {result.requires_processing}')
print(f'Individual counts: {result.individual_counts}')
import sys
sys.path.insert(0, '.')
from doc4llm.tool.md_doc_retrieval import MarkdownDocExtractor

extractor = MarkdownDocExtractor()
result = extractor.extract_by_titles_with_metadata(['Agent Skills'], threshold=2100)

print(f'Total lines: {result.total_line_count}')
print(f'Requires processing: {result.requires_processing}')
print(f'Individual counts: {result.individual_counts}')
  --title "Agent Skills" \
  --headings "1. Create your first Skill,2. How Skills work,3. Configure Skills,4.1. Simple Skill (single file),5.1. View and test Skills,5.2. Skill not triggering,5.3. Skill doesn't load,5.4. Skill has errors,5.5. Multiple Skills conflict" \
  --doc-set "Claude_Code_Docs@latest"
  --title "Agent Skills" \
  --headings "1. Create your first Skill,2. How Skills work,3. Configure Skills,4.1. Simple Skill (single file),5.1. View and test Skills,5.2. Skill not triggering,5.3. Skill doesn't load,5.4. Skill has errors,5.5. Multiple Skills conflict" \
  --doc-set "Claude_Code_Docs@latest"
  --title "Agent Skills" \
  --doc-set "Claude_Code_Docs@latest"
  --title "Agent Skills" \
  --doc-set "Claude_Code_Docs@latest"
  --title "Agent Skills" \
  --doc-set "Claude_Code_Docs@latest" \
  --base-dir ~/project/md_docs_base
  --title "Agent Skills" \
  --doc-set "Claude_Code_Docs@latest" \
  --base-dir ~/project/md_docs_base
  --title "Agent Skills" \
  --headings "1. Create your first Skill,2. How Skills work,2.1. Where Skills live,2.2. When to use Skills versus other options,3. Configure Skills,3.5. Run Skills in a forked context,3.6. Define hooks for Skills,3.8. Skills and subagents,3.9. Distribute Skills,5.1. View and test Skills" \
  --doc-set "Claude_Code_Docs@latest"
  --title "Agent Skills" \
  --headings "1. Create your first Skill,2. How Skills work,2.1. Where Skills live,2.2. When to use Skills versus other options,3. Configure Skills,3.5. Run Skills in a forked context,3.6. Define hooks for Skills,3.8. Skills and subagents,3.9. Distribute Skills,5.1. View and test Skills" \
  --doc-set "Claude_Code_Docs@latest"
  --title "Agent Skills" \
  --headings "3. Configure Skills,3.1. Write SKILL.md,3.5. Run Skills in a forked context,3.6. Define hooks for Skills,3.7. Control Skill visibility,3.8. Skills and subagents,3.9. Distribute Skills" \
  --doc-set "Claude_Code_Docs@latest"
  --title "Agent Skills" \
  --headings "3. Configure Skills,3.1. Write SKILL.md,3.5. Run Skills in a forked context,3.6. Define hooks for Skills,3.7. Control Skill visibility,3.8. Skills and subagents,3.9. Distribute Skills" \
  --doc-set "Claude_Code_Docs@latest"
--config '{"sections": [
  ]' \
  --format json
  ]' \
  --format json
  --title "Create custom subagents" \
  --doc-set "Claude_Code_Docs@latest" \
  --with-metadata \
  --threshold 2100
  --title "Create custom subagents" \
  --doc-set "Claude_Code_Docs@latest" \
  --with-metadata \
  --threshold 2100
  --title "Create custom subagents" \
  --doc-set "Claude_Code_Docs@latest" \
  --with-metadata \
  --threshold 2100 2>&1 | tail -20
  --title "Create custom subagents" \
  --doc-set "Claude_Code_Docs@latest" \
  --with-metadata \
  --threshold 2100 2>&1 | tail -20
  --config '{"sections": [{"title":"Agent Skills","headings":["3.8. Skills and subagents","3.8.1. Give a subagent access to Skills","3.8.2. Run a Skill in a subagent context"],"doc_set":"Claude_Code_Docs@latest"},{"title":"Create custom subagents","headings":["2. Quickstart: create your first subagent","3.3. Write subagent files","3. Subagent configuration"],"doc_set":"Claude_Code_Docs@latest"}]}' \
  --format json \
  --with-metadata
  --config '{"sections": [{"title":"Agent Skills","headings":["3.8. Skills and subagents","3.8.1. Give a subagent access to Skills","3.8.2. Run a Skill in a subagent context"],"doc_set":"Claude_Code_Docs@latest"},{"title":"Create custom subagents","headings":["2. Quickstart: create your first subagent","3.3. Write subagent files","3. Subagent configuration"],"doc_set":"Claude_Code_Docs@latest"}]}' \
  --format json \
  --with-metadata
]' --format json --with-metadata
results = api.search_multi_query(queries)

# 输出JSON格式
output = {
    'results': results
print(json.dumps(output, ensure_ascii=False, indent=2))
import sys
sys.path.insert(0, '.')
from doc4llm.tool.md_doc_retrieval.doc_searcher_api import DocSearcherAPI
import json

api = DocSearcherAPI(
    reranker_threshold=0.68
)

results = api.search_multi_query(queries)

# 输出JSON格式
output = {
    'results': results
print(json.dumps(output, ensure_ascii=False, indent=2))
import sys
sys.path.insert(0, '/Users/zorro/project/doc4llm')

# Read the knowledge base configuration
import json
with open('.claude/knowledge_base.json', 'r') as f:
    config = json.load(f)

print(f'Document Root: {config[\"document_root\"]}')
print(f'TOC File: {config[\"toc_filename\"]}')
import sys
sys.path.insert(0, '/Users/zorro/project/doc4llm')

# Read the knowledge base configuration
import json
with open('.claude/knowledge_base.json', 'r') as f:
    config = json.load(f)

print(f'Document Root: {config[\"document_root\"]}')
print(f'TOC File: {config[\"toc_filename\"]}')
  --title "Agent Skills" \
  --headings "Agent Skills,3.8. Skills and subagents,3.8.1. Give a subagent access to Skills,3.8.2. Run a Skill in a subagent context,3. Configure Skills" \
  --doc-set "Claude_Code_Docs@latest" \
  --format json \
  --with-metadata
  --title "Agent Skills" \
  --headings "Agent Skills,3.8. Skills and subagents,3.8.1. Give a subagent access to Skills,3.8.2. Run a Skill in a subagent context,3. Configure Skills" \
  --doc-set "Claude_Code_Docs@latest" \
  --format json \
  --with-metadata
  --title "Agent Skills" \
  --headings "Agent Skills,3.8. Skills and subagents,3.8.1. Give a subagent access to Skills,3.8.2. Run a Skill in a subagent context,3. Configure Skills" \
  --doc-set "Claude_Code_Docs@latest" \
  --with-metadata \
  --doc-info
  --title "Agent Skills" \
  --headings "Agent Skills,3.8. Skills and subagents,3.8.1. Give a subagent access to Skills,3.8.2. Run a Skill in a subagent context,3. Configure Skills" \
  --doc-set "Claude_Code_Docs@latest" \
  --with-metadata \
  --doc-info
  --title "Agent Skills" \
  --headings "Agent Skills,3.8. Skills and subagents,3.8.1. Give a subagent access to Skills,3.8.2. Run a Skill in a subagent context,3. Configure Skills" \
  --doc-set "Claude_Code_Docs@latest" \
  --with-metadata 2>&1 | head -100
  --title "Agent Skills" \
  --headings "Agent Skills,3.8. Skills and subagents,3.8.1. Give a subagent access to Skills,3.8.2. Run a Skill in a subagent context,3. Configure Skills" \
  --doc-set "Claude_Code_Docs@latest" \
  --with-metadata 2>&1 | head -100
原始查询：claude code 如何设置命令执行的timeout超时时间

关键要素：
1. Claude Code - 产品名称
2. timeout - 超时配置
3. 超时时间 - 中文表述
4. 命令执行 - 执行上下文

优化策略：
- 精确匹配："Claude Code timeout", "command execution timeout"
- 上下文扩展：bash timeout, script timeout, tool timeout
- 配置相关：settings, configuration, timeout settings
EOF
cat /tmp/query_optimizer_input.txt
原始查询：claude code 如何设置命令执行的timeout超时时间

关键要素：
1. Claude Code - 产品名称
2. timeout - 超时配置
3. 超时时间 - 中文表述
4. 命令执行 - 执行上下文

优化策略：
- 精确匹配："Claude Code timeout", "command execution timeout"
- 上下文扩展：bash timeout, script timeout, tool timeout
- 配置相关：settings, configuration, timeout settings
EOF
cat /tmp/query_optimizer_input.txt
import json
import os

# Search for any .md files that might contain content
base_dir = '/Users/zorro/project/md_docs_base/Claude_Code_Docs@latest'

# Walk through directory structure
for root, dirs, files in os.walk(base_dir):
    for file in files:
        if file.endswith('.md') and file != 'docTOC.md':
            print(os.path.join(root, file))
import json
import os

# Search for any .md files that might contain content
base_dir = '/Users/zorro/project/md_docs_base/Claude_Code_Docs@latest'

# Walk through directory structure
for root, dirs, files in os.walk(base_dir):
    for file in files:
        if file.endswith('.md') and file != 'docTOC.md':
            print(os.path.join(root, file))
import json

# 用户查询
user_query = 'how to create skills in OpenCode'

# 文档集检测
base_dir = '/Users/zorro/project/md_docs_base'
import os
print(json.dumps({
    'query_analysis': {
    'optimized_queries': [
    'search_recommendation': {
        'reason': 'Doc-set OpenCode_Docs@latest matches query'
}, indent=2))
import json

# 用户查询
user_query = 'how to create skills in OpenCode'

# 文档集检测
base_dir = '/Users/zorro/project/md_docs_base'
import os
print(json.dumps({
    'query_analysis': {
    'optimized_queries': [
    'search_recommendation': {
        'reason': 'Doc-set OpenCode_Docs@latest matches query'
}, indent=2))
import json

# Phase 4 输入
scene = 'how_to'
processed_doc = '''# Agent Skills

> **原文链接**: https://opencode.ai/docs/skills

---

## Overview

Agent skills let OpenCode discover reusable instructions from your repo or home directory. Skills are loaded on-demand via the native \`skill\` tool—agents see available skills and can load the full content when needed.

---

## Step 1: Place Files

Create one folder per skill name and put a \`SKILL.md\` inside it. OpenCode searches these locations:

- Project config: \`.opencode/skills/<name>/SKILL.md\`
- Global config: \`~/.config/opencode/skills/<name>/SKILL.md\`
- Project Claude-compatible: \`.claude/skills/<name>/SKILL.md\`
- Global Claude-compatible: \`~/.claude/skills/<name>/SKILL.md\`

---

## Step 2: Write Frontmatter

Each \`SKILL.md\` must start with YAML frontmatter:

\`\`\`yaml
---
name: git-release
description: Create consistent releases and changelogs
license: MIT
compatibility: opencode
metadata:
  audience: maintainers
  workflow: github
---
\`\`\`

**Required fields:**
- \`name\` (required) - Skill identifier
- \`description\` (required) - 1-1024 characters

**Optional fields:**
- \`license\` - License information
- \`compatibility\` - Compatibility info
- \`metadata\` - String-to-string map

---

## Step 3: Validate Names

Skill \`name\` must:
- Be 1-64 characters
- Be lowercase alphanumeric with single hyphen separators
- Not start or end with \`-\`
- Not contain consecutive \`--\`
- Match the directory name

**Regex:** \`^[a-z0-9]+(-[a-z0-9]+)*$\`

---

## Step 4: Write Skill Content

After frontmatter, add your skill instructions:

\`\`\`markdown
## What I do

- Draft release notes from merged PRs
- Propose a version bump
- Provide a copy-pasteable \`gh release create\` command

## When to use me

Use this when you are preparing a tagged release.
\`\`\`

---

## Step 5: Configure Permissions (Optional)

Control skill access in \`opencode.json\`:

\`\`\`json
  \"permission\": {
    \"skill\": {
      \"experimental-*\": \"ask\"
\`\`\`

**Permission levels:**
- \`allow\` - Loads immediately
- \`deny\` - Hidden from agents
- \`ask\` - User prompted for approval

---

## Step 6: Per-Agent Override (Optional)

For custom agents (in agent frontmatter):

\`\`\`yaml
---
permission:
  skill:
    \"documents-*\": \"allow\"
---
\`\`\`

---

## Troubleshooting

If a skill does not show up:

1. Verify \`SKILL.md\` is spelled in all caps
2. Check that frontmatter includes \`name\` and \`description\`
3. Ensure skill names are unique across all locations
4. Check permissions—skills with \`deny\` are hidden from agents
'''

doc_meta = {
    'local_path': '/Users/zorro/project/md_docs_base/OpenCode_Docs@latest/Agent Skills/docContent.md'

# Phase 4 输出
output = f'''# OpenCode Agent Skills 创建指南

本文档介绍如何在 OpenCode 中创建自定义 Agent Skills，实现可复用的行为定义。

---

## 快速开始

### 1. 创建技能文件

为每个技能创建一个文件夹，并在其中放置 `SKILL.md` 文件：

**文件位置（按优先级）：**
- 项目配置：`.opencode/skills/<skill_name>/SKILL.md`
- 全局配置：`~/.config/opencode/skills/<skill_name>/SKILL.md`
- Claude 兼容（项目）：`.claude/skills/<skill_name>/SKILL.md`
- Claude 兼容（全局）：`~/.claude/skills/<skill_name>/SKILL.md`

### 2. 编写 Frontmatter

每个 `SKILL.md` 必须以 YAML frontmatter 开头：

```yaml
---
name: git-release
description: Create consistent releases and changelogs
license: MIT
compatibility: opencode
metadata:
  audience: maintainers
  workflow: github
---
```

**必填字段：**
- `name` - 技能名称
- `description` - 描述（1-1024字符）

**选填字段：**
- `license` - 许可证信息
- `compatibility` - 兼容性信息
- `metadata` - 键值对元数据

### 3. 技能命名规范

技能名称 `name` 必须满足：
- 长度 1-64 个字符
- 小写字母和数字，使用单连字符分隔
- 不能以 `-` 开头或结尾
- 不能包含连续的 `--`
- 必须与文件夹名称一致

**正则表达式：** `^[a-z0-9]+(-[a-z0-9]+)*$`

---

## 完整示例

创建 `.opencode/skills/git-release/SKILL.md`：

```yaml
---
name: git-release
description: Create consistent releases and changelogs
license: MIT
compatibility: opencode
metadata:
  audience: maintainers
  workflow: github
---

## What I do

- Draft release notes from merged PRs
- Propose a version bump
- Provide a copy-pasteable `gh release create` command

## When to use me

Use this when you are preparing a tagged release.
Ask clarifying questions if the target versioning scheme is unclear.
```

---

## 权限配置

### 全局权限配置（在 `opencode.json` 中）

```json
```

**权限级别：**
| 权限 | 行为 |
|------|------|
| `allow` | 立即加载 |
| `deny` | 对代理隐藏 |
| `ask` | 加载前提示用户 |

### 按代理覆盖权限

**自定义代理（在 frontmatter 中）：**

```yaml
---
permission:
  skill:
---
```

**内置代理（在 `opencode.json` 中）：**

```json
```

---

## 禁用技能工具

### 对于自定义代理

```yaml
---
tools:
  skill: false
---
```

### 对于内置代理

```json
```

---

## 故障排除

如果技能没有显示：

1. 确认 `SKILL.md` 文件名全大写
2. 检查 frontmatter 必须包含 `name` 和 `description`
3. 确保技能名称在所有位置都是唯一的
4. 检查权限配置（`deny` 权限的技能对代理隐藏）

---

## 参考链接

- **官方文档**: https://opencode.ai/docs/skills
- **文档集**: OpenCode_Docs@latest
'''

print(output)
import json

# Phase 4 输入
scene = 'how_to'
processed_doc = '''# Agent Skills

> **原文链接**: https://opencode.ai/docs/skills

---

## Overview

Agent skills let OpenCode discover reusable instructions from your repo or home directory. Skills are loaded on-demand via the native \`skill\` tool—agents see available skills and can load the full content when needed.

---

## Step 1: Place Files

Create one folder per skill name and put a \`SKILL.md\` inside it. OpenCode searches these locations:

- Project config: \`.opencode/skills/<name>/SKILL.md\`
- Global config: \`~/.config/opencode/skills/<name>/SKILL.md\`
- Project Claude-compatible: \`.claude/skills/<name>/SKILL.md\`
- Global Claude-compatible: \`~/.claude/skills/<name>/SKILL.md\`

---

## Step 2: Write Frontmatter

Each \`SKILL.md\` must start with YAML frontmatter:

\`\`\`yaml
---
name: git-release
description: Create consistent releases and changelogs
license: MIT
compatibility: opencode
metadata:
  audience: maintainers
  workflow: github
---
\`\`\`

**Required fields:**
- \`name\` (required) - Skill identifier
- \`description\` (required) - 1-1024 characters

**Optional fields:**
- \`license\` - License information
- \`compatibility\` - Compatibility info
- \`metadata\` - String-to-string map

---

## Step 3: Validate Names

Skill \`name\` must:
- Be 1-64 characters
- Be lowercase alphanumeric with single hyphen separators
- Not start or end with \`-\`
- Not contain consecutive \`--\`
- Match the directory name

**Regex:** \`^[a-z0-9]+(-[a-z0-9]+)*$\`

---

## Step 4: Write Skill Content

After frontmatter, add your skill instructions:

\`\`\`markdown
## What I do

- Draft release notes from merged PRs
- Propose a version bump
- Provide a copy-pasteable \`gh release create\` command

## When to use me

Use this when you are preparing a tagged release.
\`\`\`

---

## Step 5: Configure Permissions (Optional)

Control skill access in \`opencode.json\`:

\`\`\`json
  \"permission\": {
    \"skill\": {
      \"experimental-*\": \"ask\"
\`\`\`

**Permission levels:**
- \`allow\` - Loads immediately
- \`deny\` - Hidden from agents
- \`ask\` - User prompted for approval

---

## Step 6: Per-Agent Override (Optional)

For custom agents (in agent frontmatter):

\`\`\`yaml
---
permission:
  skill:
    \"documents-*\": \"allow\"
---
\`\`\`

---

## Troubleshooting

If a skill does not show up:

1. Verify \`SKILL.md\` is spelled in all caps
2. Check that frontmatter includes \`name\` and \`description\`
3. Ensure skill names are unique across all locations
4. Check permissions—skills with \`deny\` are hidden from agents
'''

doc_meta = {
    'local_path': '/Users/zorro/project/md_docs_base/OpenCode_Docs@latest/Agent Skills/docContent.md'

# Phase 4 输出
output = f'''# OpenCode Agent Skills 创建指南

本文档介绍如何在 OpenCode 中创建自定义 Agent Skills，实现可复用的行为定义。

---

## 快速开始

### 1. 创建技能文件

为每个技能创建一个文件夹，并在其中放置 `SKILL.md` 文件：

**文件位置（按优先级）：**
- 项目配置：`.opencode/skills/<skill_name>/SKILL.md`
- 全局配置：`~/.config/opencode/skills/<skill_name>/SKILL.md`
- Claude 兼容（项目）：`.claude/skills/<skill_name>/SKILL.md`
- Claude 兼容（全局）：`~/.claude/skills/<skill_name>/SKILL.md`

### 2. 编写 Frontmatter

每个 `SKILL.md` 必须以 YAML frontmatter 开头：

```yaml
---
name: git-release
description: Create consistent releases and changelogs
license: MIT
compatibility: opencode
metadata:
  audience: maintainers
  workflow: github
---
```

**必填字段：**
- `name` - 技能名称
- `description` - 描述（1-1024字符）

**选填字段：**
- `license` - 许可证信息
- `compatibility` - 兼容性信息
- `metadata` - 键值对元数据

### 3. 技能命名规范

技能名称 `name` 必须满足：
- 长度 1-64 个字符
- 小写字母和数字，使用单连字符分隔
- 不能以 `-` 开头或结尾
- 不能包含连续的 `--`
- 必须与文件夹名称一致

**正则表达式：** `^[a-z0-9]+(-[a-z0-9]+)*$`

---

## 完整示例

创建 `.opencode/skills/git-release/SKILL.md`：

```yaml
---
name: git-release
description: Create consistent releases and changelogs
license: MIT
compatibility: opencode
metadata:
  audience: maintainers
  workflow: github
---

## What I do

- Draft release notes from merged PRs
- Propose a version bump
- Provide a copy-pasteable `gh release create` command

## When to use me

Use this when you are preparing a tagged release.
Ask clarifying questions if the target versioning scheme is unclear.
```

---

## 权限配置

### 全局权限配置（在 `opencode.json` 中）

```json
```

**权限级别：**
| 权限 | 行为 |
|------|------|
| `allow` | 立即加载 |
| `deny` | 对代理隐藏 |
| `ask` | 加载前提示用户 |

### 按代理覆盖权限

**自定义代理（在 frontmatter 中）：**

```yaml
---
permission:
  skill:
---
```

**内置代理（在 `opencode.json` 中）：**

```json
```

---

## 禁用技能工具

### 对于自定义代理

```yaml
---
tools:
  skill: false
---
```

### 对于内置代理

```json
```

---

## 故障排除

如果技能没有显示：

1. 确认 `SKILL.md` 文件名全大写
2. 检查 frontmatter 必须包含 `name` 和 `description`
3. 确保技能名称在所有位置都是唯一的
4. 检查权限配置（`deny` 权限的技能对代理隐藏）

---

## 参考链接

- **官方文档**: https://opencode.ai/docs/skills
- **文档集**: OpenCode_Docs@latest
'''

print(output)
import json

# 用户查询
query = 'OpenCode 如何创建 skills'

# 知识库目录

# Doc-Set Detection
query_lower = query.lower()
for ds in doc_sets_available:
    ds_name = ds.split('@')[0].lower()
    ds_underscore = ds_name.replace('_', '')
    if ds_name in query_lower or ds_underscore in query_lower:
        doc_set.append(ds)

print('=== Phase 0a: Query Optimization Result ===')
print(f'Original Query: {query}')
print(f'Detected Doc Set: {doc_set}')

# 优化查询
optimized_queries = [

# Domain Nouns

# Predicate Verbs (derived from optimized queries)

result = {
    'query_analysis': {
        'predicate_verbs': predicate_verbs
    'search_recommendation': {
        'reason': 'Target documentation found in local knowledge base'

print(json.dumps(result, ensure_ascii=False, indent=2))
import json

# 用户查询
query = 'OpenCode 如何创建 skills'

# 知识库目录

# Doc-Set Detection
query_lower = query.lower()
for ds in doc_sets_available:
    ds_name = ds.split('@')[0].lower()
    ds_underscore = ds_name.replace('_', '')
    if ds_name in query_lower or ds_underscore in query_lower:
        doc_set.append(ds)

print('=== Phase 0a: Query Optimization Result ===')
print(f'Original Query: {query}')
print(f'Detected Doc Set: {doc_set}')

# 优化查询
optimized_queries = [

# Domain Nouns

# Predicate Verbs (derived from optimized queries)

result = {
    'query_analysis': {
        'predicate_verbs': predicate_verbs
    'search_recommendation': {
        'reason': 'Target documentation found in local knowledge base'

print(json.dumps(result, ensure_ascii=False, indent=2))
query = 'OpenCode 如何创建 skills'
result = {
    'query_analysis': {
    'optimized_queries': [
import json; print(json.dumps(result, ensure_ascii=False, indent=2))
query = 'OpenCode 如何创建 skills'
result = {
    'query_analysis': {
    'optimized_queries': [
import json; print(json.dumps(result, ensure_ascii=False, indent=2))
query = 'OpenCode 如何创建 skills'
result = {
    'query_analysis': {
    'optimized_queries': [
import json; print(json.dumps(result, ensure_ascii=False, indent=2))
query = 'OpenCode 如何创建 skills'
result = {
    'query_analysis': {
    'optimized_queries': [
import json; print(json.dumps(result, ensure_ascii=False, indent=2))
import json

query = 'OpenCode 如何创建 skills'

# 分类场景
# 检查是否是 how_to 或 faithful_how_to
# 这个查询是询问创建方法，但没有指定具体文档，所以是 how_to
scene = 'how_to'
confidence = 0.85
ambiguity = 0.2
coverage_need = 0.6

# how_to 的 base threshold 是 0.7
base_threshold = 0.7
reranker_threshold = base_threshold + 0.01 * confidence - 0.01 * ambiguity + 0.01 * coverage_need
reranker_threshold = round(min(0.80, max(0.30, reranker_threshold)), 2)

result = {
    'reranker_threshold': reranker_threshold

print(json.dumps(result, indent=2))
import json

query = 'OpenCode 如何创建 skills'

# 分类场景
# 检查是否是 how_to 或 faithful_how_to
# 这个查询是询问创建方法，但没有指定具体文档，所以是 how_to
scene = 'how_to'
confidence = 0.85
ambiguity = 0.2
coverage_need = 0.6

# how_to 的 base threshold 是 0.7
base_threshold = 0.7
reranker_threshold = base_threshold + 0.01 * confidence - 0.01 * ambiguity + 0.01 * coverage_need
reranker_threshold = round(min(0.80, max(0.30, reranker_threshold)), 2)

result = {
    'reranker_threshold': reranker_threshold

print(json.dumps(result, indent=2))
import sys
sys.path.insert(0, '/Users/zorro/project/doc4llm')

import json

# Phase 1: Document Discovery
config = {
    'json': True

print('Phase 1 Config:', json.dumps(config, indent=2))
import sys
sys.path.insert(0, '/Users/zorro/project/doc4llm')

import json

# Phase 1: Document Discovery
config = {
    'json': True

print('Phase 1 Config:', json.dumps(config, indent=2))
import sys
sys.path.insert(0, '.')
from doc4llm.tool.md_doc_retrieval.doc_extractor import DocExtractor

base_dir = '/Users/zorro/project/md_docs_base'
doc_set = 'OpenCode_Docs@latest'

# 查找 OpenCode_Docs 中的 toc 文件
toc_path = f'{base_dir}/{doc_set}/docTOC.md'
print(f'TOC Path: {toc_path}')

import os
if os.path.exists(toc_path):
    print('TOC 文件存在')
    with open(toc_path, 'r') as f:
        content = f.read()
        # 搜索 skills 相关内容
        import re
        skills_sections = re.findall(r'^##+ .*skill.*$', content, re.MULTILINE | re.IGNORECASE)
        print('Skills 相关章节:')
        for s in skills_sections[:10]:
            print(f'  - {s}')
else:
    print('TOC 文件不存在')
    # 列出目录结构
    for root, dirs, files in os.walk(f'{base_dir}/{doc_set}'):
        for f in files:
            if 'skill' in f.lower() or 'SKILL' in f:
                print(f'找到: {os.path.join(root, f)}')
import sys
sys.path.insert(0, '.')
from doc4llm.tool.md_doc_retrieval.doc_extractor import DocExtractor

base_dir = '/Users/zorro/project/md_docs_base'
doc_set = 'OpenCode_Docs@latest'

# 查找 OpenCode_Docs 中的 toc 文件
toc_path = f'{base_dir}/{doc_set}/docTOC.md'
print(f'TOC Path: {toc_path}')

import os
if os.path.exists(toc_path):
    print('TOC 文件存在')
    with open(toc_path, 'r') as f:
        content = f.read()
        # 搜索 skills 相关内容
        import re
        skills_sections = re.findall(r'^##+ .*skill.*$', content, re.MULTILINE | re.IGNORECASE)
        print('Skills 相关章节:')
        for s in skills_sections[:10]:
            print(f'  - {s}')
else:
    print('TOC 文件不存在')
    # 列出目录结构
    for root, dirs, files in os.walk(f'{base_dir}/{doc_set}'):
        for f in files:
            if 'skill' in f.lower() or 'SKILL' in f:
                print(f'找到: {os.path.join(root, f)}')
  if grep -q -i "skill" "$toc" 2>/dev/null; then
    echo "=== $(dirname $toc) ==="
    grep -i "skill" "$toc" | head -5
  fi
done
  if grep -q -i "skill" "$toc" 2>/dev/null; then
    echo "=== $(dirname $toc) ==="
    grep -i "skill" "$toc" | head -5
  fi
done
import json

# Phase 0b output
scene = "how_to"
routing_params = {

# 文档内容 (Agent Skills)
processed_doc = """# Agent Skills

> **原文链接**: https://opencode.ai/docs/skills

---

# Agent Skills

Define reusable behavior via SKILL.md definitions

Agent skills let OpenCode discover reusable instructions from your repo or home directory. Skills are loaded on-demand via the native `skill` tool—agents see available skills and can load the full content when needed.

* * *

## Place files

Create one folder per skill name and put a `SKILL.md` inside it. OpenCode searches these locations:

- Project config: `.opencode/skills/<name>/SKILL.md`
- Global config: `~/.config/opencode/skills/<name>/SKILL.md`
- Project Claude-compatible: `.claude/skills/<name>/SKILL.md`
- Global Claude-compatible: `~/.claude/skills/<name>/SKILL.md`

* * *

## Understand discovery

For project-local paths, OpenCode walks up from your current working directory until it reaches the git worktree. It loads any matching `skills/*/SKILL.md` in `.opencode/` and any matching `.claude/skills/*/SKILL.md` along the way.

Global definitions are also loaded from `~/.config/opencode/skills/*/SKILL.md` and `~/.claude/skills/*/SKILL.md`.

* * *

## Write frontmatter

Each `SKILL.md` must start with YAML frontmatter. Only these fields are recognized:

- `name` (required)
- `description` (required)
- `license` (optional)
- `compatibility` (optional)
- `metadata` (optional, string-to-string map)

Unknown frontmatter fields are ignored.

* * *

## Validate names

`name` must:

- Be 1-64 characters
- Be lowercase alphanumeric with single hyphen separators
- Not start or end with `-`
- Not contain consecutive `--`
- Match the directory name that contains `SKILL.md`

Equivalent regex:
`^[a-z0-9]+(-[a-z0-9]+)*$`

* * *

## Follow length rules

`description` must be 1-1024 characters. Keep it specific enough for the agent to choose correctly.

* * *

## Use an example

Create `.opencode/skills/git-release/SKILL.md` like this:

```
---
name: git-release
description: Create consistent releases and changelogs
license: MIT
compatibility: opencode
metadata:
  audience: maintainers
  workflow: github
---

## What I do

- Draft release notes from merged PRs
- Propose a version bump
- Provide a copy-pasteable `gh release create` command

## When to use me

Use this when you are preparing a tagged release.
Ask clarifying questions if the target versioning scheme is unclear.
```

* * *

## Recognize tool description

OpenCode lists available skills in the `skill` tool description. Each entry includes the skill name and description:

```
<available_skills>
  <skill>
    <name>git-release</name>
    <description>Create consistent releases and changelogs</description>
  </skill>
</available_skills>
```

The agent loads a skill by calling the tool:

```
skill({ name: "git-release" })
```

* * *

## Configure permissions

Control which skills agents can access using pattern-based permissions in `opencode.json`:

```json
```

Permission | Behavior
---|---
`allow` | Skill loads immediately
`deny` | Skill hidden from agent, access rejected
`ask` | User prompted for approval before loading

Patterns support wildcards: `internal-*` matches `internal-docs`, `internal-tools`, etc.

* * *

## Override per agent

Give specific agents different permissions than the global defaults.

**For custom agents** (in agent frontmatter):

```yaml
---
permission:
  skill:
---
```

**For built-in agents** (in `opencode.json`):

```json
```

* * *

## Disable the skill tool

Completely disable skills for agents that should not use them:

**For custom agents**:

```yaml
---
tools:
  skill: false
---
```

**For built-in agents**:

```json
```

When disabled, the `<available_skills>` section is omitted entirely.

* * *

## Troubleshoot loading

If a skill does not show up:

1. Verify `SKILL.md` is spelled in all caps
2. Check that frontmatter includes `name` and `description`
3. Ensure skill names are unique across all locations
4. Check permissions-skills with `deny` are hidden from agents

doc_meta = {

# Phase 4: Scene-Based Output (how_to scene)
output = f"""# OpenCode Agent Skills 创建指南

## 概述

Agent Skills 允许 OpenCode 从你的仓库或主目录发现可复用的指令。Skills 通过原生的 `skill` 工具按需加载，代理可以看到可用的技能，并在需要时加载完整内容。

---

## 一、创建 Skills 文件

### 1.1 文件位置

为每个 skill 创建一个文件夹，并在其中放置 `SKILL.md` 文件。OpenCode 会在以下位置搜索：

| 类型 | 路径 |
|------|------|
| 项目配置 | `.opencode/skills/<name>/SKILL.md` |
| 全局配置 | `~/.config/opencode/skills/<name>/SKILL.md` |
| Claude 兼容（项目） | `.claude/skills/<name>/SKILL.md` |
| Claude 兼容（全局） | `~/.claude/skills/<name>/SKILL.md` |

### 1.2 搜索规则

- **项目路径**：OpenCode 从当前工作目录向上遍历，直到到达 git 工作树
- **全局定义**：从 `~/.config/opencode/skills/*/SKILL.md` 和 `~/.claude/skills/*/SKILL.md` 加载

---

## 二、编写 SKILL.md 文件

### 2.1 YAML Frontmatter 必需字段

每个 `SKILL.md` 必须以 YAML frontmatter 开头，支持以下字段：

| 字段 | 必填 | 说明 |
|------|------|------|
| `name` | 是 | Skill 名称 |
| `description` | 是 | 描述（1-1024字符） |
| `license` | 否 | 许可证 |
| `compatibility` | 否 | 兼容性 |
| `metadata` | 否 | 元数据键值对 |

### 2.2 名称验证规则

`name` 必须满足：

- 长度：1-64 字符
- 格式：小写字母和数字，使用单连字符分隔
- 禁止：以 `-` 开头或结尾，禁止连续 `--`
- 必须：与包含 `SKILL.md` 的目录名称匹配

**正则表达式**：`^[a-z0-9]+(-[a-z0-9]+)*$`

---

## 三、完整示例

创建 `.opencode/skills/git-release/SKILL.md`：

```yaml
---
name: git-release
description: Create consistent releases and changelogs
license: MIT
compatibility: opencode
metadata:
  audience: maintainers
  workflow: github
---

## What I do

- Draft release notes from merged PRs
- Propose a version bump
- Provide a copy-pasteable `gh release create` command

## When to use me

Use this when you are preparing a tagged release.
Ask clarifying questions if the target versioning scheme is unclear.
```

---

## 四、Skill 加载与使用

### 4.1 可用技能列表

OpenCode 在 `skill` 工具描述中列出可用的技能，每个条目包含技能名称和描述：

```xml
<available_skills>
  <skill>
    <name>git-release</name>
    <description>Create consistent releases and changelogs</description>
  </skill>
</available_skills>
```

### 4.2 加载 Skill

代理通过调用工具加载 skill：

```python
skill({{ name: "git-release" }})
```

---

## 五、权限配置

### 5.1 全局权限控制

在 `opencode.json` 中使用基于模式的权限控制：

```json
```

| 权限 | 行为 |
|------|------|
| `allow` | 立即加载 skill |
| `deny` | 对代理隐藏，访问被拒绝 |
| `ask` | 加载前提示用户批准 |

支持通配符模式：`internal-*` 匹配 `internal-docs`、`internal-tools` 等。

### 5.2 为特定 Agent 覆盖权限

**自定义 Agent**（在 frontmatter 中）：

```yaml
---
permission:
  skill:
---
```

**内置 Agent**（在 `opencode.json` 中）：

```json
```

### 5.3 禁用 Skill 工具

**自定义 Agent**：

```yaml
---
tools:
  skill: false
---
```

**内置 Agent**：

```json
```

禁用后，`<available_skills>` 部分将完全省略。

---

## 六、故障排除

如果 skill 没有显示，请检查：

1. 验证 `SKILL.md` 是否全大写拼写
2. 检查 frontmatter 是否包含 `name` 和 `description`
3. 确保 skill 名称在所有位置唯一
4. 检查权限（`deny` 的 skill 对代理隐藏）

---

### 文档来源 (Sources)

1. **Agent Skills**
   - 原文链接: https://opencode.ai/docs/skills
   - 路径: `/Users/zorro/project/md_docs_base/OpenCode_Docs@latest/Agent Skills/docContent.md`

# 打印 AOP-FINAL 输出
print(f"=== AOP-FINAL | agent=doc-retriever | format=markdown | lines=85 | source=OpenCode_Docs@latest ===")
print(output)
print("=== END-AOP-FINAL ===")
EOF
import json

# Phase 0b output
scene = "how_to"
routing_params = {

# 文档内容 (Agent Skills)
processed_doc = """# Agent Skills

> **原文链接**: https://opencode.ai/docs/skills

---

# Agent Skills

Define reusable behavior via SKILL.md definitions

Agent skills let OpenCode discover reusable instructions from your repo or home directory. Skills are loaded on-demand via the native `skill` tool—agents see available skills and can load the full content when needed.

* * *

## Place files

Create one folder per skill name and put a `SKILL.md` inside it. OpenCode searches these locations:

- Project config: `.opencode/skills/<name>/SKILL.md`
- Global config: `~/.config/opencode/skills/<name>/SKILL.md`
- Project Claude-compatible: `.claude/skills/<name>/SKILL.md`
- Global Claude-compatible: `~/.claude/skills/<name>/SKILL.md`

* * *

## Understand discovery

For project-local paths, OpenCode walks up from your current working directory until it reaches the git worktree. It loads any matching `skills/*/SKILL.md` in `.opencode/` and any matching `.claude/skills/*/SKILL.md` along the way.

Global definitions are also loaded from `~/.config/opencode/skills/*/SKILL.md` and `~/.claude/skills/*/SKILL.md`.

* * *

## Write frontmatter

Each `SKILL.md` must start with YAML frontmatter. Only these fields are recognized:

- `name` (required)
- `description` (required)
- `license` (optional)
- `compatibility` (optional)
- `metadata` (optional, string-to-string map)

Unknown frontmatter fields are ignored.

* * *

## Validate names

`name` must:

- Be 1-64 characters
- Be lowercase alphanumeric with single hyphen separators
- Not start or end with `-`
- Not contain consecutive `--`
- Match the directory name that contains `SKILL.md`

Equivalent regex:
`^[a-z0-9]+(-[a-z0-9]+)*$`

* * *

## Follow length rules

`description` must be 1-1024 characters. Keep it specific enough for the agent to choose correctly.

* * *

## Use an example

Create `.opencode/skills/git-release/SKILL.md` like this:

```
---
name: git-release
description: Create consistent releases and changelogs
license: MIT
compatibility: opencode
metadata:
  audience: maintainers
  workflow: github
---

## What I do

- Draft release notes from merged PRs
- Propose a version bump
- Provide a copy-pasteable `gh release create` command

## When to use me

Use this when you are preparing a tagged release.
Ask clarifying questions if the target versioning scheme is unclear.
```

* * *

## Recognize tool description

OpenCode lists available skills in the `skill` tool description. Each entry includes the skill name and description:

```
<available_skills>
  <skill>
    <name>git-release</name>
    <description>Create consistent releases and changelogs</description>
  </skill>
</available_skills>
```

The agent loads a skill by calling the tool:

```
skill({ name: "git-release" })
```

* * *

## Configure permissions

Control which skills agents can access using pattern-based permissions in `opencode.json`:

```json
```

Permission | Behavior
---|---
`allow` | Skill loads immediately
`deny` | Skill hidden from agent, access rejected
`ask` | User prompted for approval before loading

Patterns support wildcards: `internal-*` matches `internal-docs`, `internal-tools`, etc.

* * *

## Override per agent

Give specific agents different permissions than the global defaults.

**For custom agents** (in agent frontmatter):

```yaml
---
permission:
  skill:
---
```

**For built-in agents** (in `opencode.json`):

```json
```

* * *

## Disable the skill tool

Completely disable skills for agents that should not use them:

**For custom agents**:

```yaml
---
tools:
  skill: false
---
```

**For built-in agents**:

```json
```

When disabled, the `<available_skills>` section is omitted entirely.

* * *

## Troubleshoot loading

If a skill does not show up:

1. Verify `SKILL.md` is spelled in all caps
2. Check that frontmatter includes `name` and `description`
3. Ensure skill names are unique across all locations
4. Check permissions-skills with `deny` are hidden from agents

doc_meta = {

# Phase 4: Scene-Based Output (how_to scene)
output = f"""# OpenCode Agent Skills 创建指南

## 概述

Agent Skills 允许 OpenCode 从你的仓库或主目录发现可复用的指令。Skills 通过原生的 `skill` 工具按需加载，代理可以看到可用的技能，并在需要时加载完整内容。

---

## 一、创建 Skills 文件

### 1.1 文件位置

为每个 skill 创建一个文件夹，并在其中放置 `SKILL.md` 文件。OpenCode 会在以下位置搜索：

| 类型 | 路径 |
|------|------|
| 项目配置 | `.opencode/skills/<name>/SKILL.md` |
| 全局配置 | `~/.config/opencode/skills/<name>/SKILL.md` |
| Claude 兼容（项目） | `.claude/skills/<name>/SKILL.md` |
| Claude 兼容（全局） | `~/.claude/skills/<name>/SKILL.md` |

### 1.2 搜索规则

- **项目路径**：OpenCode 从当前工作目录向上遍历，直到到达 git 工作树
- **全局定义**：从 `~/.config/opencode/skills/*/SKILL.md` 和 `~/.claude/skills/*/SKILL.md` 加载

---

## 二、编写 SKILL.md 文件

### 2.1 YAML Frontmatter 必需字段

每个 `SKILL.md` 必须以 YAML frontmatter 开头，支持以下字段：

| 字段 | 必填 | 说明 |
|------|------|------|
| `name` | 是 | Skill 名称 |
| `description` | 是 | 描述（1-1024字符） |
| `license` | 否 | 许可证 |
| `compatibility` | 否 | 兼容性 |
| `metadata` | 否 | 元数据键值对 |

### 2.2 名称验证规则

`name` 必须满足：

- 长度：1-64 字符
- 格式：小写字母和数字，使用单连字符分隔
- 禁止：以 `-` 开头或结尾，禁止连续 `--`
- 必须：与包含 `SKILL.md` 的目录名称匹配

**正则表达式**：`^[a-z0-9]+(-[a-z0-9]+)*$`

---

## 三、完整示例

创建 `.opencode/skills/git-release/SKILL.md`：

```yaml
---
name: git-release
description: Create consistent releases and changelogs
license: MIT
compatibility: opencode
metadata:
  audience: maintainers
  workflow: github
---

## What I do

- Draft release notes from merged PRs
- Propose a version bump
- Provide a copy-pasteable `gh release create` command

## When to use me

Use this when you are preparing a tagged release.
Ask clarifying questions if the target versioning scheme is unclear.
```

---

## 四、Skill 加载与使用

### 4.1 可用技能列表

OpenCode 在 `skill` 工具描述中列出可用的技能，每个条目包含技能名称和描述：

```xml
<available_skills>
  <skill>
    <name>git-release</name>
    <description>Create consistent releases and changelogs</description>
  </skill>
</available_skills>
```

### 4.2 加载 Skill

代理通过调用工具加载 skill：

```python
skill({{ name: "git-release" }})
```

---

## 五、权限配置

### 5.1 全局权限控制

在 `opencode.json` 中使用基于模式的权限控制：

```json
```

| 权限 | 行为 |
|------|------|
| `allow` | 立即加载 skill |
| `deny` | 对代理隐藏，访问被拒绝 |
| `ask` | 加载前提示用户批准 |

支持通配符模式：`internal-*` 匹配 `internal-docs`、`internal-tools` 等。

### 5.2 为特定 Agent 覆盖权限

**自定义 Agent**（在 frontmatter 中）：

```yaml
---
permission:
  skill:
---
```

**内置 Agent**（在 `opencode.json` 中）：

```json
```

### 5.3 禁用 Skill 工具

**自定义 Agent**：

```yaml
---
tools:
  skill: false
---
```

**内置 Agent**：

```json
```

禁用后，`<available_skills>` 部分将完全省略。

---

## 六、故障排除

如果 skill 没有显示，请检查：

1. 验证 `SKILL.md` 是否全大写拼写
2. 检查 frontmatter 是否包含 `name` 和 `description`
3. 确保 skill 名称在所有位置唯一
4. 检查权限（`deny` 的 skill 对代理隐藏）

---

### 文档来源 (Sources)

1. **Agent Skills**
   - 原文链接: https://opencode.ai/docs/skills
   - 路径: `/Users/zorro/project/md_docs_base/OpenCode_Docs@latest/Agent Skills/docContent.md`

# 打印 AOP-FINAL 输出
print(f"=== AOP-FINAL | agent=doc-retriever | format=markdown | lines=85 | source=OpenCode_Docs@latest ===")
print(output)
print("=== END-AOP-FINAL ===")
EOF
output = '''# OpenCode Agent Skills 创建指南

## 概述

Agent Skills 允许 OpenCode 从你的仓库或主目录发现可复用的指令。Skills 通过原生的 skill 工具按需加载。

---

## 一、创建 Skills 文件

### 1.1 文件位置

为每个 skill 创建一个文件夹，并放置 SKILL.md 文件。OpenCode 搜索以下位置：

- 项目配置: .opencode/skills/<name>/SKILL.md
- 全局配置: ~/.config/opencode/skills/<name>/SKILL.md
- Claude 兼容（项目）: .claude/skills/<name>/SKILL.md
- Claude 兼容（全局）: ~/.claude/skills/<name>/SKILL.md

### 1.2 搜索规则

- 项目路径：从当前目录向上遍历到 git 工作树
- 全局定义：从 ~/.config/opencode/skills/*/SKILL.md 加载

---

## 二、编写 SKILL.md

### 2.1 YAML Frontmatter 必需字段

每个 SKILL.md 必须以 YAML frontmatter 开头：

| 字段 | 必填 | 说明 |
|------|------|------|
| name | 是 | Skill 名称 |
| description | 是 | 描述（1-1024字符） |
| license | 否 | 许可证 |
| compatibility | 否 | 兼容性 |
| metadata | 否 | 元数据键值对 |

### 2.2 名称验证规则

name 必须满足：
- 长度：1-64 字符
- 格式：小写字母数字，单连字符分隔
- 禁止：以 - 开头/结尾，禁止连续 --
- 必须：与目录名称匹配

正则：^[a-z0-9]+(-[a-z0-9]+)*$

---

## 三、完整示例

创建 .opencode/skills/git-release/SKILL.md：

---
name: git-release
description: Create consistent releases and changelogs
license: MIT
compatibility: opencode
metadata:
  audience: maintainers
  workflow: github
---

## What I do

- Draft release notes from merged PRs
- Propose a version bump
- Provide a copy-pasteable gh release create command

## When to use me

Use this when you are preparing a tagged release.

---

## 四、权限配置

在 opencode.json 中配置：

  \"permission\": {
    \"skill\": {
      \"experimental-*\": \"ask\"

| 权限 | 行为 |
|------|------|
| allow | 立即加载 |
| deny | 对代理隐藏 |
| ask | 提示用户批准 |

---

## 五、故障排除

如果 skill 没有显示：
1. 验证 SKILL.md 全大写拼写
2. 检查包含 name 和 description
3. 确保名称唯一
4. 检查权限设置

---

### 文档来源 (Sources)

1. **Agent Skills**
   - 原文链接: https://opencode.ai/docs/skills
   - 路径: /Users/zorro/project/md_docs_base/OpenCode_Docs@latest/Agent Skills/docContent.md
'''

print('=== AOP-FINAL | agent=doc-retriever | format=markdown | lines=65 | source=OpenCode_Docs@latest ===')
print(output)
print('=== END-AOP-FINAL ===')
output = '''# OpenCode Agent Skills 创建指南

## 概述

Agent Skills 允许 OpenCode 从你的仓库或主目录发现可复用的指令。Skills 通过原生的 skill 工具按需加载。

---

## 一、创建 Skills 文件

### 1.1 文件位置

为每个 skill 创建一个文件夹，并放置 SKILL.md 文件。OpenCode 搜索以下位置：

- 项目配置: .opencode/skills/<name>/SKILL.md
- 全局配置: ~/.config/opencode/skills/<name>/SKILL.md
- Claude 兼容（项目）: .claude/skills/<name>/SKILL.md
- Claude 兼容（全局）: ~/.claude/skills/<name>/SKILL.md

### 1.2 搜索规则

- 项目路径：从当前目录向上遍历到 git 工作树
- 全局定义：从 ~/.config/opencode/skills/*/SKILL.md 加载

---

## 二、编写 SKILL.md

### 2.1 YAML Frontmatter 必需字段

每个 SKILL.md 必须以 YAML frontmatter 开头：

| 字段 | 必填 | 说明 |
|------|------|------|
| name | 是 | Skill 名称 |
| description | 是 | 描述（1-1024字符） |
| license | 否 | 许可证 |
| compatibility | 否 | 兼容性 |
| metadata | 否 | 元数据键值对 |

### 2.2 名称验证规则

name 必须满足：
- 长度：1-64 字符
- 格式：小写字母数字，单连字符分隔
- 禁止：以 - 开头/结尾，禁止连续 --
- 必须：与目录名称匹配

正则：^[a-z0-9]+(-[a-z0-9]+)*$

---

## 三、完整示例

创建 .opencode/skills/git-release/SKILL.md：

---
name: git-release
description: Create consistent releases and changelogs
license: MIT
compatibility: opencode
metadata:
  audience: maintainers
  workflow: github
---

## What I do

- Draft release notes from merged PRs
- Propose a version bump
- Provide a copy-pasteable gh release create command

## When to use me

Use this when you are preparing a tagged release.

---

## 四、权限配置

在 opencode.json 中配置：

  \"permission\": {
    \"skill\": {
      \"experimental-*\": \"ask\"

| 权限 | 行为 |
|------|------|
| allow | 立即加载 |
| deny | 对代理隐藏 |
| ask | 提示用户批准 |

---

## 五、故障排除

如果 skill 没有显示：
1. 验证 SKILL.md 全大写拼写
2. 检查包含 name 和 description
3. 确保名称唯一
4. 检查权限设置

---

### 文档来源 (Sources)

1. **Agent Skills**
   - 原文链接: https://opencode.ai/docs/skills
   - 路径: /Users/zorro/project/md_docs_base/OpenCode_Docs@latest/Agent Skills/docContent.md
'''

print('=== AOP-FINAL | agent=doc-retriever | format=markdown | lines=65 | source=OpenCode_Docs@latest ===')
print(output)
print('=== END-AOP-FINAL ===')
